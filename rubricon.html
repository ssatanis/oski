<!DOCTYPE html>
<html data-wf-domain="tenet-template.webflow.io" data-wf-page="683d91777124b040c4a5b5cd" data-wf-site="683d91777124b040c4a5b5db" lang="en">
<head>
    <meta charset="utf-8">
    <title>Rubricon | Oski</title>
    <meta content="Transform OSCE rubrics into AI-ready prompts with intelligent OCR processing and automated YAML generation." name="description">
    <meta content="Rubricon - Oski" property="og:title">
    <meta content="Transform OSCE rubrics into AI-ready prompts with intelligent OCR processing and automated YAML generation." property="og:description">
    <meta content="images/OskiPreview.png" property="og:image">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    
    <!-- Supabase Authentication -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    <!-- Oski CSS Framework -->
    <link href="https://cdn.prod.website-files.com/683d91777124b040c4a5b5db/css/tenet-template.webflow.shared.40365d26e.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous">
    <script src="js/1.6.26-webfont.js" type="text/javascript"></script>
    <script type="text/javascript">WebFont.load({  google: {    families: ["Geist:100,200,300,regular,500,600,700,800,900","Prata:regular"]  }});</script>
    <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>

    <!-- Dynamic Favicon -->
    <script>
    function setFavicon() {
      const isDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      const favicon = document.querySelector('link[rel="shortcut icon"]') || document.createElement('link');
      favicon.rel = 'shortcut icon';
      favicon.type = 'image/svg+xml';
      favicon.href = isDarkMode ? 'favicons/White.svg' : 'favicons/Black.svg';
      if (!document.querySelector('link[rel="shortcut icon"]')) {
        document.head.appendChild(favicon);
      }
    }
    setFavicon();
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', setFavicon);
    </script>

    <link href="favicons/683d91777124b040c4a5b5db-683d91777124b040c4a5b63e_logo.png" rel="apple-touch-icon">
    
    <style>
        /* Hide Webflow badge */
        .w-webflow-badge {
            display: none !important;
        }

        /* Rubricon Specific Styles - Beautiful White with Animated Rainbow Gradient */
        .promptgen-section {
            padding: 120px 0 20px;
            background: linear-gradient(135deg, #ffffff 0%, #ffffff 100%);
            min-height: calc(100vh - 200px);
            position: relative;
            overflow: hidden;
        }

        /* Remove the rainbow line */
        .promptgen-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, 
                #ff6b6b 0%, 
                #4ecdc4 14%, 
                #45b7d1 28%, 
                #96ceb4 42%, 
                #ffeaa7 56%, 
                #fab1a0 70%, 
                #fd79a8 84%, 
                #fdcb6e 100%
            );
            background-size: 200% 100%;
            animation: rainbowMove 8s ease-in-out infinite;
            opacity: 0.8;
            z-index: 1;
            display: none;
        }

        /* Subtle animated gradient background for depth */
        .promptgen-section::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                rgba(255, 107, 107, 0.02) 0%,
                rgba(78, 205, 196, 0.02) 25%,
                rgba(69, 183, 209, 0.02) 50%,
                rgba(150, 206, 180, 0.02) 75%,
                rgba(255, 234, 167, 0.02) 100%
            );
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            pointer-events: none;
            z-index: 0;
        }

        /* Ensure content appears above the gradient */
        .promptgen-container {
            position: relative;
            z-index: 2;
        }

        @keyframes rainbowMove {
            0%, 100% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
        }

        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

        /* Fix footer and navigation link styling - Remove underlines but keep bold */
        .footer a, .footer .button-first-line {
            text-decoration: none !important;
            border-bottom: none !important;
            font-weight: 600 !important;
        }

        .footer a:hover, .footer .button-first-line:hover {
            text-decoration: none !important;
            border-bottom: none !important;
            font-weight: 600 !important;
        }

        /* Ensure Navigation and Useful Links sections have no underlines but stay bold */
        .navigation-grid a {
            text-decoration: none !important;
            border-bottom: none !important;
            font-weight: 600 !important;
        }

        .navigation-grid a:hover {
            text-decoration: none !important;
            border-bottom: none !important;
            font-weight: 600 !important;
        }

        /* Override any conflicting styles */
        .footer .button-line-flex div {
            text-decoration: none !important;
            border-bottom: none !important;
            font-weight: 600 !important;
        }

        /* Remove underlines from contact links and keep normal weight */
        .footer .title-small a {
            text-decoration: none !important;
            border-bottom: none !important;
            font-weight: normal !important;
        }

        .footer .title-small a:hover {
            text-decoration: none !important;
            border-bottom: none !important;
            opacity: 0.8;
        }

        /* Header navigation link styling */
        .navbar-link {
            text-decoration: none !important;
            border-bottom: none !important;
        }

        .navbar-link:hover {
            text-decoration: none !important;
            border-bottom: none !important;
        }

        /* Header logo normal size */
        .logotype {
            width: 100px !important;
            height: auto !important;
        }

        /* Perfect adaptive footer system */
        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .promptgen-section {
            flex: 1;
            padding-bottom: 40px; /* Reduced gap to footer */
            transition: padding-bottom 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* ============================================ */
        /* RUBRICON DASHBOARD - OSKI DESIGN LANGUAGE */
        /* ============================================ */
        
        /* Dashboard Container */
        #dashboardSection {
            opacity: 0;
            transform: translateY(40px) scale(0.98);
            transition: all 0.7s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        #dashboardSection.visible {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
        
        /* Criteria Container with Enhanced Layout */
        #criteriaContainer {
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin: 30px 0;
        }
        
        /* Individual Rubric Sections */
        .rubric-section {
            background: #ffffff;
            border-radius: 20px;
            border: 1px solid #f1f3f4;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06), 0 2px 4px rgba(0, 0, 0, 0.08);
            padding: 30px;
            margin-bottom: 0;
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            animation: slideUpIn 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            opacity: 0;
            transform: translateY(30px);
        }
        
        .rubric-section:nth-child(1) { animation-delay: 0.1s; }
        .rubric-section:nth-child(2) { animation-delay: 0.2s; }
        .rubric-section:nth-child(3) { animation-delay: 0.3s; }
        .rubric-section:nth-child(4) { animation-delay: 0.4s; }
        .rubric-section:nth-child(5) { animation-delay: 0.5s; }
        
        @keyframes slideUpIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .rubric-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #000000, #374151);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .rubric-section:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12), 0 4px 8px rgba(0, 0, 0, 0.08);
        }
        
        .rubric-section:hover::before {
            opacity: 1;
        }
        
        /* Section Header */
        .section-header-editable {
            margin-bottom: 25px;
        }
        
        .section-title-row {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 0;
            flex-wrap: wrap;
        }
        
        .section-name-input {
            font-size: 1.4rem;
            font-weight: 700;
            color: #1f2937;
            border: 2px solid transparent;
            background: transparent;
            padding: 12px 16px;
            border-radius: 12px;
            flex: 1;
            min-width: 300px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: "Geist", sans-serif;
        }
        
        .section-name-input:focus {
            border-color: #000000;
            background: #f9fafb;
            outline: none;
            box-shadow: 0 0 0 4px rgba(0, 0, 0, 0.1);
            transform: translateY(-1px);
        }
        
        .section-name-input:hover {
            background: #f9fafb;
        }
        
        .section-points {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #f9fafb;
            padding: 12px 16px;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            transition: all 0.3s ease;
            font-family: "Geist", sans-serif;
        }
        
        .section-points:hover {
            border-color: #d1d5db;
            background: #f3f4f6;
        }
        
        .section-points label {
            font-weight: 600;
            color: #374151;
            margin: 0;
            font-size: 0.9rem;
        }
        
        .section-max-points {
            width: 70px;
            border: 2px solid transparent;
            border-radius: 8px;
            padding: 8px 12px;
            text-align: center;
            background: #ffffff;
            font-weight: 600;
            color: #1f2937;
            transition: all 0.3s ease;
            font-family: "Geist", sans-serif;
        }
        
        .section-max-points:focus {
            border-color: #000000;
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1);
            transform: scale(1.05);
        }
        
        /* Items Container */
        .section-items {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        /* Individual Rubric Items */
        .rubric-item {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .rubric-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #6b7280, #9ca3af);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .rubric-item:hover {
            background: #ffffff;
            border-color: #d1d5db;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .rubric-item:hover::before {
            opacity: 1;
        }
        
        /* Item Header */
        .item-header {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            margin-bottom: 16px;
        }
        
        .item-number {
            font-weight: 700;
            color: #374151;
            min-width: 30px;
            background: #ffffff;
            padding: 6px 10px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e5e7eb;
            font-family: "Geist", sans-serif;
        }
        
        .item-content {
            flex: 1;
            display: flex;
            gap: 16px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .item-description {
            flex: 1;
            min-width: 250px;
            border: 2px solid transparent;
            border-radius: 12px;
            padding: 14px 16px;
            font-size: 1rem;
            background: #ffffff;
            color: #1f2937;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: "Geist", sans-serif;
            font-weight: 500;
        }
        
        .item-description:focus {
            border-color: #000000;
            outline: none;
            box-shadow: 0 0 0 4px rgba(0, 0, 0, 0.1);
            transform: translateY(-1px);
        }
        
        .item-description:hover {
            border-color: #d1d5db;
        }
        
        .item-points-container {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #ffffff;
            padding: 8px 12px;
            border-radius: 10px;
            border: 1px solid #e5e7eb;
        }
        
        .item-points-container label {
            font-weight: 600;
            color: #374151;
            margin: 0;
            font-size: 0.85rem;
            font-family: "Geist", sans-serif;
        }
        
        .item-points {
            width: 55px;
            border: 2px solid transparent;
            border-radius: 8px;
            padding: 6px 8px;
            text-align: center;
            background: #f9fafb;
            font-weight: 600;
            color: #1f2937;
            transition: all 0.3s ease;
            font-family: "Geist", sans-serif;
        }
        
        .item-points:focus {
            border-color: #000000;
            outline: none;
            background: #ffffff;
            box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1);
            transform: scale(1.05);
        }
        
        /* Examples Section */
        .item-examples {
            margin-left: 46px;
            margin-top: 16px;
        }
        
        .item-examples label {
            font-weight: 600;
            color: #374151;
            font-size: 0.9rem;
            margin-bottom: 8px;
            display: block;
            font-family: "Geist", sans-serif;
        }
        
        .examples-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 8px;
        }
        
        .example-item {
            display: flex;
            gap: 12px;
            align-items: center;
            animation: fadeInUp 0.3s ease forwards;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .example-item input {
            flex: 1;
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 10px 14px;
            font-size: 0.9rem;
            background: #ffffff;
            color: #374151;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: "Geist", sans-serif;
        }
        
        .example-item input:focus {
            border-color: #6b7280;
            outline: none;
            box-shadow: 0 0 0 3px rgba(107, 114, 128, 0.1);
            transform: translateY(-1px);
        }
        
        .example-item input:hover {
            border-color: #d1d5db;
            background: #f9fafb;
        }
        
        /* Buttons - Oski Style */
        .remove-section-btn,
        .remove-item-btn,
        .remove-example {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: #ffffff;
            border: none;
            border-radius: 10px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            font-family: "Geist", sans-serif;
        }
        
        .remove-section-btn::before,
        .remove-item-btn::before,
        .remove-example::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .remove-section-btn:hover::before,
        .remove-item-btn:hover::before,
        .remove-example:hover::before {
            left: 100%;
        }
        
        .remove-section-btn:hover,
        .remove-item-btn:hover,
        .remove-example:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.3);
        }
        
        .add-item-btn,
        .add-example-btn,
        .add-section-btn {
            background: linear-gradient(135deg, #000000, #374151);
            color: #ffffff;
            border: none;
            border-radius: 12px;
            padding: 12px 20px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin-top: 12px;
            position: relative;
            overflow: hidden;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-family: "Geist", sans-serif;
        }
        
        .add-item-btn::before,
        .add-example-btn::before,
        .add-section-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .add-item-btn:hover::before,
        .add-example-btn:hover::before,
        .add-section-btn:hover::before {
            left: 100%;
        }
        
        .add-item-btn:hover,
        .add-example-btn:hover,
        .add-section-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }
        
        .add-section-btn {
            width: 100%;
            font-size: 1.1rem;
            padding: 18px 24px;
            justify-content: center;
            margin-top: 30px;
            border-radius: 16px;
        }
        
        /* Form Elements Consistency */
        #systemMessage,
        #userMessagePreamble,
        #userMessagePreview {
            border: 2px solid transparent;
            border-radius: 16px;
            padding: 20px;
            font-size: 1rem;
            background: #f9fafb;
            color: #1f2937;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: "Geist", sans-serif;
            resize: vertical;
            min-height: 120px;
        }
        
        #systemMessage:focus,
        #userMessagePreamble:focus,
        #userMessagePreview:focus {
            border-color: #000000;
            background: #ffffff;
            outline: none;
            box-shadow: 0 0 0 4px rgba(0, 0, 0, 0.1);
            transform: translateY(-1px);
        }
        
        /* Total Points Display */
        #totalPoints {
            font-size: 1.5rem;
            font-weight: 700;
            color: #000000;
            background: linear-gradient(135deg, #f9fafb, #ffffff);
            padding: 16px 24px;
            border-radius: 16px;
            border: 2px solid #e5e7eb;
            text-align: center;
            margin: 20px 0;
            transition: all 0.3s ease;
            font-family: "Geist", sans-serif;
        }
        
        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .section-title-row {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
            }
            
            .section-name-input {
                min-width: unset;
            }
            
            .item-content {
                flex-direction: column;
                align-items: stretch;
            }
            
            .item-description {
                min-width: unset;
            }
            
            .item-examples {
                margin-left: 0;
            }
            
            .rubric-section {
                padding: 20px;
            }
        }

        /* Enhanced section transitions based on state */
        .content-state-processing .promptgen-section {
            padding-bottom: 30px;
        }

        .content-state-dashboard .promptgen-section {
            padding-bottom: 20px;
        }

        .footer {
            margin-top: auto;
            background: #ffffff;
            /* Removed border-top line completely */
            transition: margin-top 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Dynamic footer positioning based on content state */
        .content-state-initial .footer {
            margin-top: auto;
        }

        .content-state-processing .footer {
            margin-top: 60px;
        }

        .content-state-dashboard .footer {
            margin-top: 80px;
        }

        /* GLOBAL BUTTON CENTERING - AFFECTS ALL PAGES */
        .button-flex {
            display: flex !important;
            justify-content: center !important;
            align-items: center !important;
            text-align: center !important;
            width: 100% !important;
        }

        .button-flex.center-mobile {
            display: flex !important;
            justify-content: center !important;
            align-items: center !important;
            text-align: center !important;
            width: 100% !important;
        }

        /* Ensure button containers are centered */
        .margin-30 .button-flex,
        .margin-40 .button-flex {
            display: flex !important;
            justify-content: center !important;
            align-items: center !important;
            text-align: center !important;
            width: 100% !important;
        }

        /* Center individual buttons */
        .button-first {
            margin: 0 auto !important;
            display: inline-block !important;
        }

        .promptgen-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .promptgen-header {
            text-align: center;
            margin-bottom: 60px;
            padding-top: 40px;
        }

        .breadcrumb-nav {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 20px;
            text-decoration: none;
            transition: all 0.3s ease;
            font-family: "Geist", sans-serif;
        }

        .breadcrumb-nav:hover {
            color: #000000;
        }

        .promptgen-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 1rem;
            font-family: "Geist", sans-serif;
        }

        .promptgen-subtitle {
            font-size: 1.1rem;
            color: #6b7280;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
            font-family: "Geist", sans-serif;
        }

        .content-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 40px;
            max-width: 800px;
            margin: 0 auto;
            margin-bottom: 20px;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Smooth adaptive content transitions */
        .content-grid.file-uploaded {
            margin-bottom: 30px;
            transform: translateY(0);
        }

        .content-grid.processing-active {
            margin-bottom: 40px;
            transform: translateY(-10px);
        }

        .content-grid.dashboard-visible {
            margin-bottom: 50px;
            transform: translateY(-20px);
        }

        /* Upload Section - Enhanced with subtle rainbow accent */
        .upload-card {
            background: #ffffff;
            border-radius: 20px;
            padding: 50px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06), 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 2px dashed #e5e7eb;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .upload-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: #000000;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1;
        }

        .upload-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0,0,0,0.02), transparent);
            transition: left 0.6s ease;
        }

        .upload-card:hover::before {
            left: 100%;
        }

        .upload-card:hover::after,
        .upload-card.dragover::after {
            opacity: 1;
        }

        .upload-card.dragover {
            border-color: #000000;
            background: #ffffff;
            transform: scale(1.02);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15), 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .upload-content {
            text-align: center;
        }

        .upload-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 30px;
            padding: 20px;
            background: #f3f4f6;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .upload-card:hover .upload-icon {
            background: #000000;
            color: #ffffff;
            transform: scale(1.1);
        }

        .upload-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #000000;
            margin-bottom: 10px;
            font-family: "Geist", sans-serif;
        }

        .upload-description {
            color: #6b7280;
            margin-bottom: 30px;
            font-size: 1rem;
            font-family: "Geist", sans-serif;
        }

        .file-input {
            display: none;
        }

        .upload-button {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            padding: 16px 32px;
            background: #000000;
            color: #ffffff;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            position: relative;
            overflow: hidden;
            font-family: "Geist", sans-serif;
        }

        .upload-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .upload-button:hover::before {
            left: 100%;
        }

        .upload-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        /* Processing Section */
        .processing-card {
            background: #ffffff;
            border-radius: 20px;
            padding: 50px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06), 0 2px 4px rgba(0, 0, 0, 0.08);
            border: 1px solid #f1f3f4;
            opacity: 0;
            transform: translateY(30px) scale(0.98);
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .processing-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: #000000;
            background-size: 200% 100%;
            opacity: 1;
        }

        .processing-card.visible {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        .file-preview {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background: #f9fafb;
            border-radius: 16px;
            border: 1px solid #e5e7eb;
        }

        .file-icon {
            width: 50px;
            height: 50px;
            background: #000000;
            color: #ffffff;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .file-info h3 {
            font-weight: 600;
            color: #000000;
            margin-bottom: 5px;
            font-family: "Geist", sans-serif;
        }

        .file-info p {
            color: #6b7280;
            font-size: 0.9rem;
            font-family: "Geist", sans-serif;
        }

        .process-button {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            padding: 18px 36px;
            background: linear-gradient(135deg, #000000 0%, #374151 100%);
            color: #ffffff;
            border: none;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            width: 100%;
            justify-content: center;
            margin-bottom: 20px;
            font-family: "Geist", sans-serif;
        }

        .process-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .process-button:hover::before {
            left: 100%;
        }

        .process-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
        }

        .process-button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        /* Status Messages */
        .status-message {
            padding: 20px;
            border-radius: 16px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 500;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
            font-family: "Geist", sans-serif;
        }

        .status-message.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .status-message.processing {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: #ffffff;
        }

        .status-message.success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: #ffffff;
        }

        .status-message.error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: #ffffff;
        }

        /* Loading Animation */
        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #ffffff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Dashboard Section - Enhanced with subtle rainbow accent */
        .dashboard-card {
            background: #ffffff;
            border-radius: 20px;
            padding: 50px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06), 0 2px 4px rgba(0, 0, 0, 0.08);
            border: 1px solid #f1f3f4;
            opacity: 0;
            transform: translateY(40px) scale(0.96);
            transition: all 0.7s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .dashboard-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: #000000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .dashboard-card.visible {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        .dashboard-card.visible::before {
            opacity: 1;
        }

        .dashboard-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .dashboard-title {
            font-family: "Prata", serif;
            font-size: 2rem;
            font-weight: 400;
            color: #000000;
            margin-bottom: 10px;
        }

        .dashboard-description {
            color: #6b7280;
            font-size: 1.1rem;
            font-family: "Geist", sans-serif;
        }

        .rubric-info {
            background: linear-gradient(135deg, #f9fafb 0%, #ffffff 100%);
            border: 1px solid #e5e7eb;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .rubric-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #000000;
            margin-bottom: 10px;
            font-family: "Geist", sans-serif;
        }

        .rubric-description {
            color: #6b7280;
            margin-bottom: 15px;
            font-family: "Geist", sans-serif;
        }

        .total-points {
            display: inline-flex;
            align-items: center;
            background: #f3f4f6;
            border-radius: 25px;
            padding: 8px 16px;
            font-size: 0.875rem;
            font-weight: 500;
            color: #000000;
            font-family: "Geist", sans-serif;
        }

        .export-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .export-button {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 16px 24px;
            background: #ffffff;
            color: #000000;
            border: 2px solid #e5e7eb;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            font-family: "Geist", sans-serif;
        }

        .export-button:hover {
            border-color: #000000;
            background: #000000;
            color: #ffffff;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .promptgen-container {
                padding: 0 15px;
            }

            .upload-card,
            .processing-card,
            .dashboard-card {
                padding: 30px 20px;
            }

            .promptgen-title {
                font-size: 2.5rem;
            }

            .export-options {
                grid-template-columns: 1fr;
            }
        }

        /* Animation Classes */
        .fade-in {
            animation: fadeIn 0.6s ease-out forwards;
        }

        .slide-up {
            animation: slideUp 0.6s ease-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(30px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Success checkmark animation */
        .checkmark {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: block;
            stroke-width: 2;
            stroke: #ffffff;
            stroke-miterlimit: 10;
            box-shadow: inset 0px 0px 0px #ffffff;
            animation: fill .4s ease-in-out .4s forwards, scale .3s ease-in-out .9s both;
        }

        .checkmark__circle {
            stroke-dasharray: 166;
            stroke-dashoffset: 166;
            stroke-width: 2;
            stroke-miterlimit: 10;
            stroke: #ffffff;
            fill: none;
            animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
        }

        .checkmark__check {
            transform-origin: 50% 50%;
            stroke-dasharray: 48;
            stroke-dashoffset: 48;
            animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
        }

        @keyframes stroke {
            100% {
                stroke-dashoffset: 0;
            }
        }

        @keyframes scale {
            0%, 100% {
                transform: none;
            }
            50% {
                transform: scale3d(1.1, 1.1, 1);
            }
        }

        /* Rubric Editor Styles */
        .rubric-editor-section {
            margin-bottom: 40px;
            padding: 25px;
            background: #f8fafc;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }

        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .editor-header h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
            margin: 0;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            font-weight: 500;
            color: #374151;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-input, .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            font-family: "Geist", sans-serif;
            background: white;
            box-sizing: border-box;
        }

        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: #000000;
            box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn-add-criterion {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: #000000;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-add-criterion:hover {
            background: #374151;
            transform: translateY(-1px);
        }

        .criteria-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .criterion-item {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            position: relative;
            transition: all 0.3s ease;
        }

        .criterion-item:hover {
            border-color: #d1d5db;
        }

        .criterion-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .criterion-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            background: #000000;
            color: white;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .btn-remove-criterion {
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px 8px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .btn-remove-criterion:hover {
            background: #dc2626;
        }

        .criterion-examples {
            margin-top: 15px;
        }

        .criterion-examples label {
            font-size: 13px;
            color: #6b7280;
        }

        .examples-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 8px;
        }

        .example-item {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .example-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 13px;
        }

        .btn-remove-example {
            background: #f87171;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 6px;
            cursor: pointer;
            font-size: 11px;
        }

        .btn-add-example {
            margin-top: 8px;
            padding: 6px 12px;
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            color: #374151;
        }

        .btn-add-example:hover {
            background: #e5e7eb;
        }

        .preview-box {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 13px;
            line-height: 1.6;
            color: #374151;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }

        .export-section {
            margin-top: 30px;
            padding: 25px;
            background: #f9fafb;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
        }

        .export-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .export-header h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
            margin: 0;
        }

        .export-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .export-button.primary {
            background: #000000;
            color: white;
        }

        .export-button.primary:hover {
            background: #374151;
            transform: translateY(-1px);
            border-color: #374151;
        }

        .export-button.secondary {
            background: #6366f1;
            color: white;
            border-color: #6366f1;
        }

        .export-button.secondary:hover {
            background: #4f46e5;
            border-color: #4f46e5;
            transform: translateY(-1px);
        }

        .export-button.tertiary {
            background: #f3f4f6;
            color: #374151;
            border-color: #d1d5db;
        }

        .export-button.tertiary:hover {
            background: #e5e7eb;
            border-color: #9ca3af;
        }

        @keyframes fill {
            100% {
                box-shadow: inset 0px 0px 0px 30px #ffffff;
            }
        }

        /* Dynamic Rubric Structure Styles */
        .section-container {
            margin-bottom: 2rem;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 1rem;
            background-color: #f9f9f9;
        }
        
        .section-header {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 1rem;
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 0.5rem;
        }
        
        .section-criteria {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .criterion-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            position: relative;
            transition: all 0.3s ease;
        }

        .criterion-card:hover {
            border-color: #d1d5db;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .criterion-card .criterion-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .criterion-card .criterion-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            background: #000000;
            color: white;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            flex-shrink: 0;
        }

        .criterion-card .criterion-name {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
        }

        .criterion-card .remove-btn {
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .criterion-card .remove-btn:hover {
            background: #dc2626;
        }

        .criterion-body {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .points-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .points-container label {
            font-size: 14px;
            font-weight: 500;
            color: #374151;
        }

        .max-points {
            width: 80px;
            padding: 6px 10px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .criterion-description {
            width: 100%;
            min-height: 60px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 0.5rem;
            font-size: 0.9rem;
            resize: vertical;
        }
        
        .description-container {
            margin-top: 0.5rem;
        }
        
        .description-container label {
            display: block;
            margin-bottom: 0.25rem;
            font-weight: 500;
            color: #555;
        }

        .examples-container label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 500;
            color: #374151;
        }

        .examples-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 12px;
        }

        .example-item {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .example-item input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 13px;
        }

        .remove-example {
            background: #f87171;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
        }

        .remove-example:hover {
            background: #ef4444;
        }

        .add-example-btn {
            padding: 8px 16px;
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            color: #374151;
            transition: all 0.3s ease;
        }

        .add-example-btn:hover {
            background: #e5e7eb;
            border-color: #9ca3af;
        }
    </style>

    <!-- Authentication Loading Screen -->
    <style>
        /* Show page content by default - NO HIDING */
        body {
            background: #ffffff;
            visibility: visible;
        }
        
        /* Simple auth overlay - only shows when needed */
        #auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 99999;
            font-family: 'Geist', 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        #auth-overlay.show {
            display: flex;
        }
        
        .auth-content {
            text-align: center;
            padding: 40px;
        }
        
        .auth-logo {
            width: 80px;
            height: auto;
            margin-bottom: 30px;
        }
        
        .auth-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(59, 130, 246, 0.1);
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .auth-text {
            color: #64748b;
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 8px;
        }
        
        .auth-subtitle {
            color: #94a3b8;
            font-size: 14px;
            font-weight: 400;
        }
    </style>

    <!-- Simple Authentication Check -->
    <script>
        // Check authentication using our custom session system
        function checkAuth() {
            try {
                // Show auth overlay immediately
                showAuthOverlay();
                
                console.log('Checking authentication...');
                
                // Check for stored session
                const sessionData = localStorage.getItem('oski_session');
                const userData = localStorage.getItem('oski_user');
                
                if (!sessionData || !userData) {
                    console.log('No session found, redirecting to login');
                    hideAuthOverlay();
                    window.location.replace('login.html');
                    return;
                }
                
                const session = JSON.parse(sessionData);
                const user = JSON.parse(userData);
                
                // Check if session is still valid
                if (!session.expires_at || Date.now() >= session.expires_at) {
                    console.log('Session expired, redirecting to login');
                    localStorage.removeItem('oski_session');
                    localStorage.removeItem('oski_user');
                    hideAuthOverlay();
                    window.location.replace('login.html');
                    return;
                }
                
                console.log('User authenticated:', user.email);
                
                // Hide auth overlay with a brief delay for smooth UX
                setTimeout(() => {
                    hideAuthOverlay();
                }, 800);
                
                // Add logout functionality
                window.logout = function() {
                    console.log('Logging out...');
                    localStorage.removeItem('oski_session');
                    localStorage.removeItem('oski_user');
                    window.location.replace('login.html');
                };
                
                // Set up session monitoring
                setInterval(() => {
                    const currentSession = localStorage.getItem('oski_session');
                    if (!currentSession) {
                        console.log('Session removed, redirecting to login');
                        window.location.replace('login.html');
                    } else {
                        const sessionObj = JSON.parse(currentSession);
                        if (Date.now() >= sessionObj.expires_at) {
                            console.log('Session expired during use, redirecting to login');
                            localStorage.removeItem('oski_session');
                            localStorage.removeItem('oski_user');
                            window.location.replace('login.html');
                        }
                    }
                }, 60000); // Check every minute
                
            } catch (error) {
                console.error('Auth check failed:', error);
                localStorage.removeItem('oski_session');
                localStorage.removeItem('oski_user');
                hideAuthOverlay();
                window.location.replace('login.html');
            }
        }
        
        function showAuthOverlay() {
            const overlay = document.getElementById('auth-overlay');
            if (overlay) {
                overlay.classList.add('show');
            }
        }
        
        function hideAuthOverlay() {
            const overlay = document.getElementById('auth-overlay');
            if (overlay) {
                overlay.classList.remove('show');
            }
        }
        
        // Wait for page to load, then check auth
        document.addEventListener('DOMContentLoaded', function() {
            // Add auth overlay to page
            const authHTML = `
                <div id="auth-overlay">
                    <div class="auth-content">
                        <img src="images/Oski.png" alt="Oski" class="auth-logo">
                        <div class="auth-spinner"></div>
                        <div class="auth-text">Verifying access permissions</div>
                        <div class="auth-subtitle">Please wait...</div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', authHTML);
            
            // Check authentication after a brief delay
            setTimeout(checkAuth, 100);
        });
    </script>
</head>

<body>
    <div class="page-wrapper">
        <!-- Header will be injected here -->
        <div id="header-container"></div>

        <!-- Rubricon Section -->
        <section class="promptgen-section">
            <div class="promptgen-container">
                                 <!-- Header -->
                 <div class="promptgen-header fade-in">
                     <div class="top-text">Interactive Demo</div>
                     <h1 class="display-1">Experience Oski's <span class="other-font">Rubricon</span> platform.</h1>
                     <div class="margin-20">
                         <p class="p-02">AI-Powered Rubric to Assessment Prompt Generator</p>
                     </div>
                     <div class="margin-30">
                         <div class="button-flex center-mobile" style="display: flex !important; justify-content: center !important; align-items: center !important; text-align: center !important; width: 100% !important;">
                             <a href="#upload" class="button-first w-inline-block">
                                 <div class="txt-wrapper">
                                     <div class="button-txt">Get Started</div>
                                     <div class="button-txt">Get Started</div>
                                 </div>
                             </a>
                         </div>
                     </div>
                 </div>

                <div class="content-grid">
                    <!-- Upload Section -->
                    <div class="upload-card slide-up" id="upload">
                        <div class="upload-content">
                            <div class="upload-icon">
                                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="7 10 12 15 17 10"></polyline>
                                    <line x1="12" y1="15" x2="12" y2="3"></line>
                                </svg>
                            </div>
                            <h2 class="upload-title">Upload Your Rubric</h2>
                            <p class="upload-description">Drag and drop your rubric file here, or click to browse.<br>
                            Supports: PDF, DOC, DOCX, XLS, XLSX, TXT, CSV, and image formats.</p>
                            
                            <input type="file" id="fileInput" class="file-input" accept=".pdf,.doc,.docx,.xls,.xlsx,.txt,.csv,.png,.jpg,.jpeg">
                            <button class="upload-button" onclick="document.getElementById('fileInput').click()">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="17 8 12 3 7 8"></polyline>
                                    <line x1="12" y1="3" x2="12" y2="15"></line>
                                </svg>
                                Choose File
                            </button>
                        </div>
                    </div>

                    <!-- Processing Section -->
                    <div class="processing-card" id="processingSection">
                        <div id="filePreview" class="file-preview" style="display: none;">
                            <div class="file-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14 2 14 8 20 8"></polyline>
                                </svg>
                            </div>
                            <div class="file-info">
                                <h3 id="fileName">No file selected</h3>
                                <p id="fileSize">Select a file to continue</p>
                            </div>
                        </div>

                        <button class="process-button" id="processButton" disabled onclick="processRubric()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="5 3 19 12 5 21 5 3"></polygon>
                            </svg>
                            Process Rubric
                        </button>

                        <div id="statusMessages"></div>
                    </div>

                    <!-- Dashboard Section -->
                    <div class="dashboard-card" id="dashboardSection">
                        <div class="dashboard-header">
                            <h2 class="dashboard-title">Rubric Editor</h2>
                            <p class="dashboard-description">Review and edit your OSCE assessment criteria before exporting to YAML format.</p>
                        </div>

                        <!-- Rubric Basic Info -->
                        <div class="rubric-editor-section">
                            <div class="editor-header">
                                <h3>Basic Information</h3>
                            </div>

                            <div class="input-group">
                                <label for="systemMessage">System Message:</label>
                                <textarea id="systemMessage" class="form-textarea" rows="3" placeholder="You are a helpful assistant..."></textarea>
                            </div>
                        </div>

                        <!-- Criteria Editor -->
                        <div class="rubric-editor-section">
                            <div class="editor-header">
                                <h3>Assessment Criteria</h3>
                                <button class="btn-add-criterion" onclick="addNewCriterion()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="12" y1="5" x2="12" y2="19"></line>
                                        <line x1="5" y1="12" x2="19" y2="12"></line>
                                    </svg>
                                    Add Criterion
                                </button>
                            </div>
                            <div id="criteriaContainer" class="criteria-container">
                                <!-- Criteria will be added dynamically -->
                            </div>
                        </div>

                        <!-- User Message Preview -->
                        <div class="rubric-editor-section">
                            <div class="editor-header">
                                <h3>Generated User Message Preview</h3>
                            </div>
                            <div class="preview-box" id="userMessagePreview">
                                <!-- Preview will be generated automatically -->
                            </div>
                        </div>

                        <!-- Export Options -->
                        <div class="export-section">
                            <div class="export-header">
                                <h3>Export Options</h3>
                                <div class="total-points">
                                    Total Points: <span id="totalPoints">0</span>
                                </div>
                            </div>
                            <div class="export-buttons">
                                <button class="export-button primary" onclick="downloadYaml()">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                        <polyline points="7 10 12 15 17 10"></polyline>
                                        <line x1="12" y1="15" x2="12" y2="3"></line>
                                    </svg>
                                    Download YAML
                                </button>
                                <button class="export-button tertiary" onclick="resetUpload()">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
                                        <path d="M21 3v5h-5"></path>
                                        <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
                                        <path d="M3 21v-5h5"></path>
                                    </svg>
                                    Start Over
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer will be injected here -->
        <div id="footer-container"></div>
    </div>

    <!-- Oski JavaScript Framework -->
    <script src="js/js-jquery-3.5.1.min.dc5e7f18c8.js" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="js/js-webflow.schunk.36b8fb49256177c8.js" type="text/javascript"></script>
    <script src="js/js-webflow.schunk.4bcee8dc3a55ab3d.js" type="text/javascript"></script>
    <script src="js/js-webflow.965f2b6a.2a699015d3217d92.js" type="text/javascript"></script>
    <script src="js/header.js" type="text/javascript"></script>
    <script src="js/footer.js" type="text/javascript"></script>

    <!-- Rubricon JavaScript -->
    <script>
        let currentFile = null;
        let processedData = null;

        // Perfect adaptive footer state management
        function updateFooterState(state) {
            const body = document.body;
            
            // Remove all existing content state classes
            body.classList.remove('content-state-initial', 'content-state-processing', 'content-state-dashboard');
            
            // Add new state class with smooth transition
            body.classList.add(`content-state-${state}`);
            
            console.log(`Footer state updated to: ${state}`);
        }
        
        // Smart Backend Configuration - FREE VERCEL SERVERLESS FUNCTIONS!
        const getBackendUrl = () => {
            // Check if we're on localhost or deployed
            const hostname = window.location.hostname;
            const isLocal = hostname === 'localhost' || hostname === '127.0.0.1' || hostname === '';
            
            if (isLocal) {
                // Local development - use localhost backend
                return 'http://localhost:8000';
            } else {
                // Production - use Vercel serverless functions (FREE!)
                // The API routes will be at /api/ on the same domain
                return window.location.origin; // Uses same domain as frontend
            }
        };
        
        const BACKEND_URL = getBackendUrl();

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize footer state
            updateFooterState('initial');
            
            setupFileUpload();
            setupDragAndDrop();
        });

        function setupFileUpload() {
            const fileInput = document.getElementById('fileInput');
            
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    handleFileSelection(file);
                }
            });
        }

        function setupDragAndDrop() {
            const uploadCard = document.getElementById('upload');

            uploadCard.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadCard.classList.add('dragover');
            });

            uploadCard.addEventListener('dragleave', function(e) {
                e.preventDefault();
                uploadCard.classList.remove('dragover');
            });

            uploadCard.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadCard.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileSelection(files[0]);
                }
            });
        }

        function handleFileSelection(file) {
            currentFile = file;
            
            // Update file preview
            const filePreview = document.getElementById('filePreview');
            const fileName = document.getElementById('fileName');
            const fileSize = document.getElementById('fileSize');
            const processButton = document.getElementById('processButton');
            const processingSection = document.getElementById('processingSection');
            const contentGrid = document.querySelector('.content-grid');

            fileName.textContent = file.name;
            fileSize.textContent = formatFileSize(file.size);
            
            filePreview.style.display = 'flex';
            processButton.disabled = false;
            
            // Update footer state for file selection
            updateFooterState('processing');
            
            // Show processing section with animation
            processingSection.classList.add('visible');
            
            // Add dynamic spacing
            contentGrid.classList.add('file-uploaded');
            
            // Smooth scroll to processing section
            setTimeout(() => {
                processingSection.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'center' 
                });
            }, 300);
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        async function processRubric() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0] || currentFile;
            
            if (!file) {
                showStatus('error', 'Please select a file first');
                return;
            }
            
            console.log('Starting rubric processing for file:', file.name);
            
            // Disable the process button and show loading state
            const processButton = document.getElementById('processButton');
            const originalButtonText = processButton.innerHTML;
            processButton.disabled = true;
            processButton.innerHTML = `
                <div class="loading-spinner"></div>
                Processing...
            `;
            
            // Show processing UI
            document.getElementById('upload').style.display = 'none';
            document.getElementById('processingSection').style.display = 'block';
            
            try {
                // Step 1: Upload and extract text
                showStatus('processing', 'Extracting text from document...');
                
                const base64Content = await fileToBase64(file);
                
                try {
                    const uploadResponse = await fetch(`${BACKEND_URL}/api/upload`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            fileContent: base64Content,
                            fileName: file.name
                        })
                    });
                    
                    if (!uploadResponse.ok) {
                        const error = await uploadResponse.json();
                        throw new Error(error.details || error.error || 'Upload failed');
                    }
                    
                    const { extracted_text } = await uploadResponse.json();
                    
                    // Step 2: Generate AI prompt
                    showStatus('processing', 'Analyzing rubric structure with AI...');
                    
                    const promptResponse = await fetch(`${BACKEND_URL}/api/generate-prompt`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ extracted_text })
                    });
                    
                    if (!promptResponse.ok) {
                        const error = await promptResponse.json();
                        throw new Error(error.details || error.error || 'Prompt generation failed');
                    }
                    
                    const { parsed_yaml } = await promptResponse.json();
                    
                    // Show success and display dashboard
                    showStatus('success', 'Rubric processed successfully!');
                    setTimeout(() => {
                        showDashboard(parsed_yaml);
                    }, 1500);
                    
                } catch (networkError) {
                    console.error('Backend connection failed:', networkError);
                    throw new Error('Cannot connect to server. Please ensure the backend is running and try again.');
                }
                
            } catch (error) {
                console.error('Processing error:', error);
                
                // Reset button state
                processButton.disabled = false;
                processButton.innerHTML = originalButtonText;
                
                // Show user-friendly error message
                let errorMessage = 'Failed to process rubric. Please try again.';
                if (error.message.includes('fetch')) {
                    errorMessage = 'Cannot connect to server. Please check your internet connection.';
                } else if (error.message.includes('Upload failed')) {
                    errorMessage = 'File upload failed. Please try uploading a different file.';
                } else if (error.message.includes('Prompt generation failed')) {
                    errorMessage = 'AI analysis failed. Please try again or contact support.';
                }
                
                showStatus('error', errorMessage);
                
                // Allow retry after a shorter delay
                setTimeout(() => {
                    document.getElementById('upload').style.display = 'block';
                    document.getElementById('processingSection').style.display = 'none';
                }, 2000);
            }
        }

        let currentRubricData = null;

        function showDashboard(parsedData) {
            // Hide processing, show dashboard
            document.getElementById('processingSection').style.display = 'none';
            document.getElementById('dashboardSection').style.display = 'block';
            
            // Store current data globally for updates
            window.currentRubricData = parsedData;
            
            // Populate basic information
            document.getElementById('systemMessage').value = parsedData.system_message || '';
            document.getElementById('userMessagePreamble').value = parsedData.user_message_preamble || '';
            
            // Clear and populate assessment criteria
            const criteriaContainer = document.getElementById('criteriaContainer');
            criteriaContainer.innerHTML = '';
            
            // Check if we have rubric_analysis for better section organization
            if (parsedData.rubric_analysis && parsedData.rubric_analysis.sections) {
                // Display by original rubric sections
                displayRubricSections(parsedData.rubric_analysis.sections, criteriaContainer);
            } else {
                // Fallback to criteria-based display
                displayCriteria(parsedData.criteria, criteriaContainer);
            }
            
            // Update footer state for dashboard
            updateFooterState('dashboard');
            
            // Add maximum spacing for dashboard
            const contentGrid = document.querySelector('.content-grid');
            contentGrid.classList.add('dashboard-visible');
            
            // Show dashboard section
            const dashboardSection = document.getElementById('dashboardSection');
            dashboardSection.classList.add('visible');
            
            // Update preview and total points
            updateUserMessagePreview();
            updateTotalPoints();
            
            // Smooth scroll to dashboard
            setTimeout(() => {
                dashboardSection.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'center' 
                });
            }, 500);
        }

        function displayRubricSections(sections, container) {
            sections.forEach((section, sectionIndex) => {
                const sectionDiv = document.createElement('div');
                sectionDiv.className = 'rubric-section';
                sectionDiv.dataset.sectionIndex = sectionIndex;
                
                // Section header with edit capability
                const sectionHeader = document.createElement('div');
                sectionHeader.className = 'section-header-editable';
                sectionHeader.innerHTML = `
                    <div class="section-title-row">
                        <input type="text" 
                               class="section-name-input" 
                               value="${section.name}" 
                               data-section-index="${sectionIndex}"
                               onchange="updateSectionName(${sectionIndex}, this.value)">
                        <div class="section-points">
                            <label>Section Total:</label>
                            <input type="number" 
                                   class="section-max-points" 
                                   value="${section.maxPoints || 0}" 
                                   min="0" 
                                   max="100"
                                   data-section-index="${sectionIndex}"
                                   onchange="updateSectionPoints(${sectionIndex}, this.value)">
                            <span>points</span>
                        </div>
                        <button class="remove-section-btn" onclick="removeSection(${sectionIndex})">Remove Section</button>
                    </div>
                `;
                sectionDiv.appendChild(sectionHeader);
                
                // Items container
                const itemsContainer = document.createElement('div');
                itemsContainer.className = 'section-items';
                
                // Display items
                if (section.items && section.items.length > 0) {
                    section.items.forEach((item, itemIndex) => {
                        const itemDiv = createItemElement(item, sectionIndex, itemIndex);
                        itemsContainer.appendChild(itemDiv);
                    });
                }
                
                // Add item button
                const addItemBtn = document.createElement('button');
                addItemBtn.className = 'add-item-btn';
                addItemBtn.textContent = '+ Add Item';
                addItemBtn.onclick = () => addItemToSection(sectionIndex);
                itemsContainer.appendChild(addItemBtn);
                
                sectionDiv.appendChild(itemsContainer);
                container.appendChild(sectionDiv);
            });
            
            // Add new section button
            const addSectionBtn = document.createElement('button');
            addSectionBtn.className = 'add-section-btn';
            addSectionBtn.textContent = '+ Add New Section';
            addSectionBtn.onclick = addNewSection;
            container.appendChild(addSectionBtn);
        }

        function displayCriteria(criteria, container) {
            // Fallback display for criteria without rubric analysis
            if (criteria && criteria.length > 0) {
                criteria.forEach((criterion, index) => {
                    const criterionElement = createCriterionElement(criterion, index);
                    container.appendChild(criterionElement);
                });
            }
        }

        function createItemElement(item, sectionIndex, itemIndex) {
            const div = document.createElement('div');
            div.className = 'rubric-item';
            div.innerHTML = `
                <div class="item-header">
                    <span class="item-number">${itemIndex + 1}.</span>
                    <div class="item-content">
                        <input type="text" 
                               class="item-description" 
                               value="${item.description}" 
                               placeholder="Item description"
                               data-section="${sectionIndex}" 
                               data-item="${itemIndex}"
                               onchange="updateItemDescription(${sectionIndex}, ${itemIndex}, this.value)">
                        <div class="item-points-container">
                            <label>Points:</label>
                            <input type="number" 
                                   class="item-points" 
                                   value="${item.points || 0}" 
                                   min="0" 
                                   max="20"
                                   data-section="${sectionIndex}" 
                                   data-item="${itemIndex}"
                                   onchange="updateItemPoints(${sectionIndex}, ${itemIndex}, this.value)">
                        </div>
                    </div>
                    <button class="remove-item-btn" onclick="removeItem(${sectionIndex}, ${itemIndex})"></button>
                </div>
                <div class="item-examples">
                    <label>Examples/Criteria:</label>
                    <div class="examples-list">
                        ${(item.examples || []).concat(item.criteria || []).map((ex, exIndex) => `
                            <div class="example-item">
                                <input type="text" 
                                       value="${ex}" 
                                       placeholder="Example or criterion"
                                       onchange="updateExample(${sectionIndex}, ${itemIndex}, ${exIndex}, this.value)">
                                <button class="remove-example" onclick="removeExample(${sectionIndex}, ${itemIndex}, ${exIndex})"></button>
                            </div>
                        `).join('')}
                    </div>
                    <button class="add-example-btn" onclick="addExample(${sectionIndex}, ${itemIndex})">+ Add Example</button>
                </div>
            `;
            return div;
        }

        // Add these functions to handle updates
        function updateSectionName(sectionIndex, newName) {
            if (window.currentRubricData.rubric_analysis) {
                window.currentRubricData.rubric_analysis.sections[sectionIndex].name = newName;
            }
            regenerateCriteria();
        }

        function updateSectionPoints(sectionIndex, newPoints) {
            if (window.currentRubricData.rubric_analysis) {
                window.currentRubricData.rubric_analysis.sections[sectionIndex].maxPoints = parseInt(newPoints) || 0;
            }
            updateTotalPoints();
            regenerateCriteria();
        }

        function updateItemDescription(sectionIndex, itemIndex, newDescription) {
            if (window.currentRubricData.rubric_analysis) {
                window.currentRubricData.rubric_analysis.sections[sectionIndex].items[itemIndex].description = newDescription;
            }
            regenerateCriteria();
        }

        function updateItemPoints(sectionIndex, itemIndex, newPoints) {
            if (window.currentRubricData.rubric_analysis) {
                window.currentRubricData.rubric_analysis.sections[sectionIndex].items[itemIndex].points = parseInt(newPoints) || 0;
            }
            updateTotalPoints();
            regenerateCriteria();
        }

        function updateExample(sectionIndex, itemIndex, exampleIndex, newExample) {
            if (window.currentRubricData.rubric_analysis) {
                const item = window.currentRubricData.rubric_analysis.sections[sectionIndex].items[itemIndex];
                const allExamples = (item.examples || []).concat(item.criteria || []);
                allExamples[exampleIndex] = newExample;
                
                // Update the appropriate array
                if (item.examples && exampleIndex < item.examples.length) {
                    item.examples[exampleIndex] = newExample;
                } else {
                    const criteriaIndex = exampleIndex - (item.examples || []).length;
                    if (item.criteria) item.criteria[criteriaIndex] = newExample;
                }
            }
            regenerateCriteria();
        }

        function addExample(sectionIndex, itemIndex) {
            if (window.currentRubricData.rubric_analysis) {
                const item = window.currentRubricData.rubric_analysis.sections[sectionIndex].items[itemIndex];
                if (!item.examples) item.examples = [];
                item.examples.push('New example');
                showDashboard(window.currentRubricData);
            }
        }

        function removeExample(sectionIndex, itemIndex, exampleIndex) {
            if (window.currentRubricData.rubric_analysis) {
                const item = window.currentRubricData.rubric_analysis.sections[sectionIndex].items[itemIndex];
                const allExamples = (item.examples || []).concat(item.criteria || []);
                
                if (exampleIndex < (item.examples || []).length) {
                    item.examples.splice(exampleIndex, 1);
                } else {
                    const criteriaIndex = exampleIndex - (item.examples || []).length;
                    if (item.criteria) item.criteria.splice(criteriaIndex, 1);
                }
                showDashboard(window.currentRubricData);
            }
        }

        function removeItem(sectionIndex, itemIndex) {
            if (window.currentRubricData.rubric_analysis) {
                window.currentRubricData.rubric_analysis.sections[sectionIndex].items.splice(itemIndex, 1);
                showDashboard(window.currentRubricData);
            }
        }

        function removeSection(sectionIndex) {
            if (window.currentRubricData.rubric_analysis) {
                window.currentRubricData.rubric_analysis.sections.splice(sectionIndex, 1);
                showDashboard(window.currentRubricData);
            }
        }

        function addItemToSection(sectionIndex) {
            if (window.currentRubricData.rubric_analysis) {
                const newItem = {
                    description: 'New criterion',
                    points: 1,
                    examples: ['Example 1'],
                    criteria: []
                };
                window.currentRubricData.rubric_analysis.sections[sectionIndex].items.push(newItem);
                showDashboard(window.currentRubricData);
            }
        }

        function addNewSection() {
            if (!window.currentRubricData.rubric_analysis) {
                window.currentRubricData.rubric_analysis = { sections: [] };
            }
            
            const newSection = {
                name: 'New Section',
                maxPoints: 5,
                items: [
                    {
                        description: 'New criterion',
                        points: 1,
                        examples: ['Example 1']
                    }
                ]
            };
            
            window.currentRubricData.rubric_analysis.sections.push(newSection);
            showDashboard(window.currentRubricData);
        }

        function regenerateCriteria() {
            // This would call the backend to regenerate the criteria based on updated sections
            updateUserMessagePreview();
        }

        function createCriterionElement(criterion, index) {
            const div = document.createElement('div');
            div.className = 'criterion-card';
            div.innerHTML = `
                <div class="criterion-header">
                    <span class="criterion-number">${index + 1}</span>
                    <input type="text" 
                           class="criterion-name" 
                           value="${criterion.itemName || criterion.name}" 
                           data-criterion-id="${criterion.id}"
                           onchange="updateUserMessagePreview()">
                    <button class="remove-btn" onclick="removeCriterionNew(this)"></button>
                </div>
                <div class="criterion-body">
                    <div class="points-container">
                        <label>Max Points:</label>
                        <input type="number" 
                               class="max-points" 
                               value="${criterion.max_points}" 
                               min="0" 
                               max="20"
                               onchange="updateUserMessagePreview(); updateTotalPoints();">
                    </div>
                    <div class="description-container">
                        <label>Description:</label>
                        <textarea class="criterion-description" 
                                  rows="2"
                                  onchange="updateUserMessagePreview()">${criterion.description || ''}</textarea>
                    </div>
                    <div class="examples-container">
                        <label>Examples:</label>
                        <div class="examples-list">
                            ${criterion.examples.map(ex => `
                                <div class="example-item">
                                    <input type="text" value="${ex}" onchange="updateUserMessagePreview()">
                                    <button class="remove-example" onclick="removeExampleNew(this)"></button>
                                </div>
                            `).join('')}
                        </div>
                        <button class="add-example-btn" onclick="addExampleNew(this)">+ Add Example</button>
                    </div>
                </div>
            `;
            
            return div;
        }

        function removeCriterionNew(button) {
            const criterionCard = button.closest('.criterion-card');
            criterionCard.remove();
            updateUserMessagePreview();
            updateTotalPoints();
        }

        function addExampleNew(button) {
            const examplesList = button.previousElementSibling;
            const exampleDiv = document.createElement('div');
            exampleDiv.className = 'example-item';
            exampleDiv.innerHTML = `
                <input type="text" value="" onchange="updateUserMessagePreview()">
                <button class="remove-example" onclick="removeExampleNew(this)"></button>
            `;
            examplesList.appendChild(exampleDiv);
        }

        function removeExampleNew(button) {
            const exampleItem = button.closest('.example-item');
            exampleItem.remove();
            updateUserMessagePreview();
        }

        function initializeDashboard(data) {
            console.log('Initializing dashboard with data:', data);
            
            // Set basic information - no key field needed for this format
            document.getElementById('systemMessage').value = data.parsed_yaml?.system_message || 'You are a helpful assistant tasked with analyzing and scoring a recorded medical examination between a medical student and a patient. Provide your response in JSON format.';
            
            // Load criteria with better error handling
            const criteria = data.parsed_yaml?.criteria || [];
            console.log('Loading criteria:', criteria);
            
            if (criteria.length > 0) {
                loadCriteria(criteria);
                console.log(`Successfully loaded ${criteria.length} criteria`);
            } else {
                console.warn('No criteria found in parsed data');
                loadCriteria([]);
            }
            
            // Update total points
            updateTotalPoints();
            
            // Update preview
            updateUserMessagePreview();
        }

        function loadCriteria(criteria) {
            const container = document.getElementById('criteriaContainer');
            container.innerHTML = '';
            
            console.log('Loading criteria into DOM:', criteria);
            
            if (criteria && criteria.length > 0) {
                criteria.forEach((criterion, index) => {
                    console.log(`Adding criterion ${index + 1}:`, criterion);
                    addCriterionToDOM(criterion, index);
                });
            } else {
                console.log('No criteria provided, adding empty criterion');
                // Add one empty criterion if none exist
                addNewCriterion();
            }
        }

        function addNewCriterion() {
            const criterion = {
                name: '',
                max_points: 1,
                examples: ['']
            };
            const container = document.getElementById('criteriaContainer');
            const index = container.children.length;
            addCriterionToDOM(criterion, index);
            updateTotalPoints();
            updateUserMessagePreview();
        }

        function addCriterionToDOM(criterion, index) {
            const container = document.getElementById('criteriaContainer');
            const criterionDiv = document.createElement('div');
            criterionDiv.className = 'criterion-item';
            criterionDiv.dataset.index = index;
            
            // Ensure criterion has required fields
            const safeGriterion = {
                name: criterion?.name || '',
                max_points: criterion?.max_points || 1,
                examples: criterion?.examples || ['']
            };
            
            // Escape HTML in values to prevent issues
            const escapedName = safeGriterion.name.replace(/"/g, '&quot;');
            const escapedExamples = safeGriterion.examples.map(ex => ex.replace(/"/g, '&quot;'));
            
            criterionDiv.innerHTML = `
                <div class="criterion-header">
                    <div style="display: flex; align-items: center;">
                        <span class="criterion-number">${index + 1}</span>
                        <div style="flex: 1;">
                            <div class="input-group" style="margin-bottom: 10px;">
                                <input type="text" class="form-input criterion-name" placeholder="e.g., Patient Greeting and Introduction" value="${escapedName}" oninput="updateCriterion(${index})">
                            </div>
                            <div class="input-group" style="margin-bottom: 0;">
                                <label>Max Points:</label>
                                <input type="number" class="form-input criterion-points" min="1" max="10" value="${safeGriterion.max_points}" oninput="updateCriterion(${index})" style="width: 80px;">
                            </div>
                        </div>
                    </div>
                    <button class="btn-remove-criterion" onclick="removeCriterion(${index})">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
                <div class="criterion-examples">
                    <label>Examples:</label>
                    <div class="examples-list">
                        ${escapedExamples.map((example, exampleIndex) => `
                            <div class="example-item">
                                <input type="text" class="example-input" placeholder="e.g., I'm going to examine your..." value="${example}" oninput="updateCriterion(${index})">
                                <button class="btn-remove-example" onclick="removeExample(${index}, ${exampleIndex})"></button>
                            </div>
                        `).join('')}
                    </div>
                    <button class="btn-add-example" onclick="addExample(${index})">+ Add Example</button>
                </div>
            `;
            
            container.appendChild(criterionDiv);
        }

        function updateCriterion(index) {
            updateTotalPoints();
            updateUserMessagePreview();
        }

        function removeCriterion(index) {
            const container = document.getElementById('criteriaContainer');
            const item = container.children[index];
            if (item) {
                item.remove();
                reindexCriteria();
                updateTotalPoints();
                updateUserMessagePreview();
            }
        }

        function addExample(criterionIndex) {
            const container = document.getElementById('criteriaContainer');
            const criterionItem = container.children[criterionIndex];
            const examplesList = criterionItem.querySelector('.examples-list');
            const exampleIndex = examplesList.children.length;
            
            const exampleDiv = document.createElement('div');
            exampleDiv.className = 'example-item';
            exampleDiv.innerHTML = `
                <input type="text" class="example-input" placeholder="e.g., I'm going to examine your..." oninput="updateCriterion(${criterionIndex})">
                <button class="btn-remove-example" onclick="removeExample(${criterionIndex}, ${exampleIndex})"></button>
            `;
            
            examplesList.appendChild(exampleDiv);
        }

        function removeExample(criterionIndex, exampleIndex) {
            const container = document.getElementById('criteriaContainer');
            const criterionItem = container.children[criterionIndex];
            const examplesList = criterionItem.querySelector('.examples-list');
            const exampleItem = examplesList.children[exampleIndex];
            if (exampleItem) {
                exampleItem.remove();
                updateCriterion(criterionIndex);
            }
        }

        function reindexCriteria() {
            const container = document.getElementById('criteriaContainer');
            Array.from(container.children).forEach((item, index) => {
                item.dataset.index = index;
                const numberSpan = item.querySelector('.criterion-number');
                if (numberSpan) numberSpan.textContent = index + 1;
                
                // Update onclick handlers
                item.innerHTML = item.innerHTML
                    .replace(/updateCriterion\(\d+\)/g, `updateCriterion(${index})`)
                    .replace(/removeCriterion\(\d+\)/g, `removeCriterion(${index})`)
                    .replace(/addExample\(\d+\)/g, `addExample(${index})`)
                    .replace(/removeExample\(\d+,\s*\d+\)/g, (match) => {
                        const exampleIndex = match.split(',')[1].replace(/\D/g, '');
                        return `removeExample(${index}, ${exampleIndex})`;
                    });
            });
        }

        function updateTotalPoints() {
            const container = document.getElementById('criteriaContainer');
            let total = 0;
            
            // Handle both old structure (.criterion-points) and new structure (.max-points)
            Array.from(container.children).forEach(item => {
                const pointsInputOld = item.querySelector('.criterion-points');
                const pointsInputsNew = item.querySelectorAll('.max-points');
                
                if (pointsInputOld) {
                    total += parseInt(pointsInputOld.value) || 0;
                }
                
                pointsInputsNew.forEach(input => {
                    total += parseInt(input.value) || 0;
                });
            });
            
            document.getElementById('totalPoints').textContent = total;
        }

        function updateUserMessagePreview() {
            const container = document.getElementById('criteriaContainer');
            const criteria = [];
            
            // Handle both old structure and new sectioned structure
            Array.from(container.children).forEach((item, index) => {
                // Check if this is a section container or a criterion item
                if (item.classList.contains('section-container')) {
                    // Handle new sectioned structure
                    const criterionCards = item.querySelectorAll('.criterion-card');
                    criterionCards.forEach(card => {
                        const nameInput = card.querySelector('.criterion-name');
                        const pointsInput = card.querySelector('.max-points');
                        const exampleInputs = card.querySelectorAll('.example-item input');
                        
                        const examples = Array.from(exampleInputs)
                            .map(input => input.value.trim())
                            .filter(value => value);
                        
                        if (nameInput && nameInput.value.trim()) {
                            criteria.push({
                                examId: nameInput.value.trim().replace(/[^a-zA-Z0-9\s]/g, '').replace(/\s+/g, '_'),
                                name: nameInput.value.trim(),
                                max_points: parseInt(pointsInput.value) || 1,
                                examples: examples.length > 0 ? examples : [`I'm going to examine your ${nameInput.value.trim().toLowerCase()}`]
                            });
                        }
                    });
                } else {
                    // Handle old structure
                    const nameInput = item.querySelector('.criterion-name');
                    const pointsInput = item.querySelector('.criterion-points');
                    const exampleInputs = item.querySelectorAll('.example-input');
                    
                    if (nameInput) {
                        const examples = Array.from(exampleInputs)
                            .map(input => input.value.trim())
                            .filter(value => value);
                        
                        if (nameInput.value.trim()) {
                            criteria.push({
                                examId: nameInput.value.trim().replace(/[^a-zA-Z0-9\s]/g, '').replace(/\s+/g, '_'),
                                name: nameInput.value.trim(),
                                max_points: parseInt(pointsInput.value) || 1,
                                examples: examples.length > 0 ? examples : [`I'm going to examine your ${nameInput.value.trim().toLowerCase()}`]
                            });
                        }
                    }
                }
            });
            
            const userMessage = generateUserMessage(criteria);
            document.getElementById('userMessagePreview').textContent = userMessage;
        }

        function generateUserMessage(criteria) {
            const examsList = criteria.map(c => c.examId || c.name.replace(/[^a-zA-Z0-9\s]/g, '').replace(/\s+/g, '_'));
            
            return `
Your task is to identify the start and end times of specific physical exams within the conversation and provide the reasoning behind your choices. Whenever the medical student asks about pain or mentions checking a specific part of the body (e.g., "any pain when I do this?" or "let me check your..."), assume that a physical exam is being conducted at that moment. You will be provided with a description and example for each exam. This station consists of the following physical exams: ${examsList.join(', ')}

Important Instructions:
- When determining the start and end times of each examination, focus on the moments where the doctor instructs the patient to perform an action (e.g., "look up at the ceiling", "look straight ahead"). Give these phrases priority for setting the \`start_time\` and \`end_time\` over phrases where the doctor states their own actions (e.g., "I'm going to look at your nose and eyes").
- Whenever the medical student asks about pain or mentions checking a specific part of the body (e.g., "any pain when I do this?" or "let me check your..."), assume that a physical exam is being conducted at that moment. You will be provided with a description and example for each exam.
- Always pay close attention to surrounding context and related physical examinations mentioned.
   
You need to identify the following physical exams from this transcript: 
${criteria.map((criterion, index) => `	 ${index + 1}. ${criterion.examId || criterion.name.replace(/[^a-zA-Z0-9\s]/g, '').replace(/\s+/g, '_')}: Did the doctor ${criterion.name.toLowerCase().includes('did') ? criterion.name.toLowerCase() : `perform ${criterion.name.toLowerCase()}`}? 
	 - Verbalization examples: ${criterion.examples.join(', ')}`).join('\n\n')}


If no exam is detected, you can say "no exam was performed", start_time: "nan", end_time: "nan", score: 0.

### Formatting Instructions

- Ensure strict adherence to JSON formatting.
- Do not use double quotes for multiple statements within a single field.
- Use commas, single quotes, or other appropriate delimiters for multiple statements.
- Do not include any text before or after the JSON output. Provide ONLY the json response.

Please provide a response in the following format with keys: ${examsList.join(', ')}

and the schema: 
{
     "statement": "statement extracted from the transcript that supports this specific exam",
     "start_time": "timepoint for start of the exam (MM:SS only)",
     "end_time": "timepoint for end of the exam (MM:SS only)",
     "rationale": "reasoning behind scoring the physical exam",
     "score": "score of the exam (0 or 1)"
}`;
        }

        async function downloadYaml() {
            console.log('Generating YAML from current dashboard content...');
            
            // Get current dashboard criteria
            const dashboardCriteria = getCurrentDashboardCriteria();
            
            if (dashboardCriteria.length === 0) {
                alert('No criteria available for download. Please add some assessment criteria first.');
                return;
            }
            
            try {
                // Generate YAML content from current dashboard state
                const response = await fetch(`${BACKEND_URL}/api/generate-prompt`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        dashboard_criteria: dashboardCriteria
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`Failed to generate YAML: ${response.status}`);
                }
                
                const data = await response.json();
                const yamlContent = data.yaml_content;
                
                downloadFile(yamlContent, 'assessment-rubric.yaml', 'text/yaml');
                console.log('YAML downloaded successfully');
                
            } catch (error) {
                console.error('Error generating YAML:', error);
                alert('Failed to generate YAML file. Please try again.');
            }
        }

        function getCurrentDashboardCriteria() {
            const container = document.getElementById('criteriaContainer');
            const criteria = [];
            
            Array.from(container.children).forEach((item, index) => {
                const nameInput = item.querySelector('.criterion-name');
                const pointsInput = item.querySelector('.criterion-points');
                const exampleInputs = item.querySelectorAll('.example-input');
                
                const examples = Array.from(exampleInputs)
                    .map(input => input.value.trim())
                    .filter(value => value);
                
                if (nameInput.value.trim()) {
                    const examId = nameInput.value.trim().replace(/[^a-zA-Z0-9\s]/g, '').replace(/\s+/g, '_');
                    criteria.push({
                        examId: examId,
                        name: nameInput.value.trim(),
                        max_points: parseInt(pointsInput.value) || 1,
                        examples: examples.length > 0 ? examples : [`I'm going to assess your ${nameInput.value.trim().toLowerCase()}`]
                    });
                }
            });
            
            return criteria;
        }

        function generateCurrentYaml() {
            const systemMessage = document.getElementById('systemMessage').value || 'You are a helpful assistant tasked with analyzing and scoring a recorded medical examination between a medical student and a patient. Provide your response in JSON format.';
            const userMessage = document.getElementById('userMessagePreview').textContent;
            
            return `system_message: 
   ${systemMessage}
   
user_message: 
  |${userMessage}
response_config:
  structured_output: True`;
        }

        // Missing utility function for converting file to base64
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => {
                    // Remove the data URL prefix to get just the base64 content
                    const base64 = reader.result.split(',')[1];
                    resolve(base64);
                };
                reader.onerror = (error) => reject(error);
            });
        }



        function showStatus(type, message, withSpinner = false) {
            const statusMessages = document.getElementById('statusMessages');
            
            const statusDiv = document.createElement('div');
            statusDiv.className = `status-message ${type}`;
            
            let iconHtml = '';
            if (withSpinner) {
                iconHtml = '<div class="loading-spinner"></div>';
            } else if (type === 'success') {
                iconHtml = `
                    <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 52 52">
                        <circle class="checkmark__circle" fill="none" stroke="white" stroke-width="2" stroke-miterlimit="10" cx="26" cy="26" r="25" />
                        <path class="checkmark__check" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="m16 26 6 6 14-16" />
                    </svg>
                `;
            } else if (type === 'error') {
                iconHtml = `
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="15" y1="9" x2="9" y2="15"></line>
                        <line x1="9" y1="9" x2="15" y2="15"></line>
                    </svg>
                `;
            }
            
            statusDiv.innerHTML = `${iconHtml}<span>${message}</span>`;
            
            // Clear previous messages if this is not a processing step
            if (type !== 'processing') {
                statusMessages.innerHTML = '';
            }
            
            statusMessages.appendChild(statusDiv);
            
            // Trigger animation
            setTimeout(() => {
                statusDiv.classList.add('visible');
            }, 100);
        }

        // Event listeners for editor updates
        document.addEventListener('DOMContentLoaded', function() {
            // Listen for changes in form inputs to update preview
            document.addEventListener('input', function(e) {
                if (e.target.matches('#systemMessage')) {
                    updateUserMessagePreview();
                }
            });
        });

        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            URL.revokeObjectURL(url);
            
            // Show success message
            showStatus('success', `${filename} downloaded successfully!`);
        }

        // Reset functionality
        function resetUpload() {
            currentFile = null;
            processedData = null;
            
            const contentGrid = document.querySelector('.content-grid');
            
            document.getElementById('fileInput').value = '';
            document.getElementById('filePreview').style.display = 'none';
            document.getElementById('processButton').disabled = true;
            document.getElementById('statusMessages').innerHTML = '';
            document.getElementById('processingSection').classList.remove('visible');
            document.getElementById('dashboardSection').classList.remove('visible');
            
            // Reset footer state to initial
            updateFooterState('initial');
            
            // Reset spacing classes
            contentGrid.classList.remove('file-uploaded', 'processing-active', 'dashboard-visible');
        }

        // Add keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                resetUpload();
            }
        });
    </script>
</body>
</html> 