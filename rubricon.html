<!DOCTYPE html>
<html data-wf-domain="tenet-template.webflow.io" data-wf-page="683d91777124b040c4a5b5cd" data-wf-site="683d91777124b040c4a5b5db" lang="en">
<head>
    <meta charset="utf-8">
    <title>Rubricon | Oski</title>
    <meta content="Transform OSCE rubrics into AI-ready prompts with intelligent OCR processing and automated YAML generation." name="description">
    <meta content="Rubricon - Oski" property="og:title">
    <meta content="Transform OSCE rubrics into AI-ready prompts with intelligent OCR processing and automated YAML generation." property="og:description">
    <meta content="images/OskiPreview.png" property="og:image">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    
    <!-- Supabase Authentication -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    <!-- Oski CSS Framework -->
    <link href="https://cdn.prod.website-files.com/683d91777124b040c4a5b5db/css/tenet-template.webflow.shared.40365d26e.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous">
    <script src="js/1.6.26-webfont.js" type="text/javascript"></script>
    <script type="text/javascript">WebFont.load({  google: {    families: ["Geist:100,200,300,regular,500,600,700,800,900","Prata:regular"]  }});</script>
    <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>

    <!-- Dynamic Favicon -->
    <script>
    function setFavicon() {
      const isDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      const favicon = document.querySelector('link[rel="shortcut icon"]') || document.createElement('link');
      favicon.rel = 'shortcut icon';
      favicon.type = 'image/svg+xml';
      favicon.href = isDarkMode ? 'favicons/White.svg' : 'favicons/Black.svg';
      if (!document.querySelector('link[rel="shortcut icon"]')) {
        document.head.appendChild(favicon);
      }
    }
    setFavicon();
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', setFavicon);
    </script>

    <link href="favicons/683d91777124b040c4a5b5db-683d91777124b040c4a5b63e_logo.png" rel="apple-touch-icon">
    
    <style>
        /* Hide Webflow badge */
        .w-webflow-badge {
            display: none !important;
        }

        /* Rubricon Specific Styles - Beautiful White with Animated Rainbow Gradient */
        .promptgen-section {
            padding: 120px 0 20px;
            background: linear-gradient(135deg, #ffffff 0%, #ffffff 100%);
            min-height: calc(100vh - 200px);
            position: relative;
            overflow: hidden;
        }

        /* Remove the rainbow line */
        .promptgen-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, 
                #ff6b6b 0%, 
                #4ecdc4 14%, 
                #45b7d1 28%, 
                #96ceb4 42%, 
                #ffeaa7 56%, 
                #fab1a0 70%, 
                #fd79a8 84%, 
                #fdcb6e 100%
            );
            background-size: 200% 100%;
            animation: rainbowMove 8s ease-in-out infinite;
            opacity: 0.8;
            z-index: 1;
            display: none;
        }

        /* Subtle animated gradient background for depth */
        .promptgen-section::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                rgba(255, 107, 107, 0.02) 0%,
                rgba(78, 205, 196, 0.02) 25%,
                rgba(69, 183, 209, 0.02) 50%,
                rgba(150, 206, 180, 0.02) 75%,
                rgba(255, 234, 167, 0.02) 100%
            );
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            pointer-events: none;
            z-index: 0;
        }

        /* Ensure content appears above the gradient */
        .promptgen-container {
            position: relative;
            z-index: 2;
        }

        @keyframes rainbowMove {
            0%, 100% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
        }

        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

        /* Fix footer and navigation link styling - Remove underlines but keep bold */
        .footer a, .footer .button-first-line {
            text-decoration: none !important;
            border-bottom: none !important;
            font-weight: 600 !important;
        }

        .footer a:hover, .footer .button-first-line:hover {
            text-decoration: none !important;
            border-bottom: none !important;
            font-weight: 600 !important;
        }

        /* Ensure Navigation and Useful Links sections have no underlines but stay bold */
        .navigation-grid a {
            text-decoration: none !important;
            border-bottom: none !important;
            font-weight: 600 !important;
        }

        .navigation-grid a:hover {
            text-decoration: none !important;
            border-bottom: none !important;
            font-weight: 600 !important;
        }

        /* Override any conflicting styles */
        .footer .button-line-flex div {
            text-decoration: none !important;
            border-bottom: none !important;
            font-weight: 600 !important;
        }

        /* Remove underlines from contact links and keep normal weight */
        .footer .title-small a {
            text-decoration: none !important;
            border-bottom: none !important;
            font-weight: normal !important;
        }

        .footer .title-small a:hover {
            text-decoration: none !important;
            border-bottom: none !important;
            opacity: 0.8;
        }

        /* Header navigation link styling */
        .navbar-link {
            text-decoration: none !important;
            border-bottom: none !important;
        }

        .navbar-link:hover {
            text-decoration: none !important;
            border-bottom: none !important;
        }

        /* Header logo normal size */
        .logotype {
            width: 100px !important;
            height: auto !important;
        }

        /* Perfect adaptive footer system */
        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .promptgen-section {
            flex: 1;
            padding-bottom: 40px; /* Reduced gap to footer */
            transition: padding-bottom 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* ============================================ */
        /* RUBRICON DASHBOARD - OSKI DESIGN LANGUAGE */
        /* ============================================ */
        
        /* Dashboard Container */
        #dashboardSection {
            display: none;
            opacity: 0;
            transform: translateY(40px) scale(0.98);
            transition: all 0.7s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        #dashboardSection.visible {
            display: block;
            opacity: 1;
            transform: translateY(0) scale(1);
        }
        
        /* Criteria Container with Enhanced Layout */
        #criteriaContainer {
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin: 30px 0;
        }
        
        /* Individual Rubric Sections */
        .rubric-section {
            background: #ffffff;
            border-radius: 20px;
            border: 1px solid #f1f3f4;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06), 0 2px 4px rgba(0, 0, 0, 0.08);
            padding: 30px;
            margin-bottom: 0;
            position: relative;
            overflow: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            animation: slideUpIn 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            opacity: 0;
            transform: translateY(30px);
        }
        
        .rubric-section:nth-child(1) { animation-delay: 0.1s; }
        .rubric-section:nth-child(2) { animation-delay: 0.2s; }
        .rubric-section:nth-child(3) { animation-delay: 0.3s; }
        .rubric-section:nth-child(4) { animation-delay: 0.4s; }
        .rubric-section:nth-child(5) { animation-delay: 0.5s; }
        
        @keyframes slideUpIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .rubric-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #000000, #374151);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .rubric-section:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12), 0 4px 8px rgba(0, 0, 0, 0.08);
        }
        
        .rubric-section:hover::before {
            opacity: 1;
        }
        
        /* Section Header */
        .section-header-editable {
            margin-bottom: 25px;
        }
        
        .section-title-row {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 0;
            flex-wrap: wrap;
        }
        
        .section-name-input {
            font-size: 1.4rem;
            font-weight: 700;
            color: #1f2937;
            border: 2px solid transparent;
            background: transparent;
            padding: 12px 16px;
            border-radius: 12px;
            flex: 1;
            min-width: 300px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: "Geist", sans-serif;
        }
        
        .section-name-input:focus {
            border-color: #000000;
            background: #f9fafb;
            outline: none;
            box-shadow: 0 0 0 4px rgba(0, 0, 0, 0.1);
            transform: translateY(-1px);
        }
        
        .section-name-input:hover {
            background: #f9fafb;
        }
        
        .section-points {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #f9fafb;
            padding: 12px 16px;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            transition: all 0.3s ease;
            font-family: "Geist", sans-serif;
        }
        
        .section-points:hover {
            border-color: #d1d5db;
            background: #f3f4f6;
        }
        
        .section-points label {
            font-weight: 600;
            color: #374151;
            margin: 0;
            font-size: 0.9rem;
        }
        
        .section-max-points {
            width: 70px;
            border: 2px solid transparent;
            border-radius: 8px;
            padding: 8px 12px;
            text-align: center;
            background: #ffffff;
            font-weight: 600;
            color: #1f2937;
            transition: all 0.3s ease;
            font-family: "Geist", sans-serif;
        }
        
        .section-max-points:focus {
            border-color: #000000;
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1);
            transform: scale(1.05);
        }
        
        /* Items Container */
        .section-items {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        /* Individual Rubric Items */
        .rubric-item {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .rubric-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #6b7280, #9ca3af);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .rubric-item:hover {
            background: #ffffff;
            border-color: #d1d5db;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .rubric-item:hover::before {
            opacity: 1;
        }
        
        /* Item Header */
        .item-header {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            margin-bottom: 16px;
        }
        
        .item-number {
            font-weight: 700;
            color: #374151;
            min-width: 30px;
            background: #ffffff;
            padding: 6px 10px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e5e7eb;
            font-family: "Geist", sans-serif;
        }
        
        .item-content {
            flex: 1;
            display: flex;
            gap: 16px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .item-description {
            flex: 1;
            min-width: 250px;
            border: 2px solid transparent;
            border-radius: 12px;
            padding: 14px 16px;
            font-size: 1rem;
            background: #ffffff;
            color: #1f2937;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: "Geist", sans-serif;
            font-weight: 500;
        }
        
        .item-description:focus {
            border-color: #000000;
            outline: none;
            box-shadow: 0 0 0 4px rgba(0, 0, 0, 0.1);
            transform: translateY(-1px);
        }
        
        .item-description:hover {
            border-color: #d1d5db;
        }
        
        .item-points-container {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #ffffff;
            padding: 8px 12px;
            border-radius: 10px;
            border: 1px solid #e5e7eb;
        }
        
        .item-points-container label {
            font-weight: 600;
            color: #374151;
            margin: 0;
            font-size: 0.85rem;
            font-family: "Geist", sans-serif;
        }
        
        .item-points {
            width: 55px;
            border: 2px solid transparent;
            border-radius: 8px;
            padding: 6px 8px;
            text-align: center;
            background: #f9fafb;
            font-weight: 600;
            color: #1f2937;
            transition: all 0.3s ease;
            font-family: "Geist", sans-serif;
        }
        
        .item-points:focus {
            border-color: #000000;
            outline: none;
            background: #ffffff;
            box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1);
            transform: scale(1.05);
        }
        
        /* Examples Section */
        .item-examples {
            margin-left: 46px;
            margin-top: 16px;
        }
        
        .item-examples label {
            font-weight: 600;
            color: #374151;
            font-size: 0.9rem;
            margin-bottom: 8px;
            display: block;
            font-family: "Geist", sans-serif;
        }
        
        .examples-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 8px;
        }
        
        .example-item {
            display: flex;
            gap: 12px;
            align-items: center;
            animation: fadeInUp 0.3s ease forwards;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .example-item input {
            flex: 1;
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 10px 14px;
            font-size: 0.9rem;
            background: #ffffff;
            color: #374151;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: "Geist", sans-serif;
        }
        
        .example-item input:focus {
            border-color: #6b7280;
            outline: none;
            box-shadow: 0 0 0 3px rgba(107, 114, 128, 0.1);
            transform: translateY(-1px);
        }
        
        .example-item input:hover {
            border-color: #d1d5db;
            background: #f9fafb;
        }
        
        /* Buttons - Oski Style */
        .remove-section-btn,
        .remove-item-btn,
        .remove-example {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: #ffffff;
            border: none;
            border-radius: 10px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            font-family: "Geist", sans-serif;
        }
        
        .remove-section-btn::before,
        .remove-item-btn::before,
        .remove-example::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .remove-section-btn:hover::before,
        .remove-item-btn:hover::before,
        .remove-example:hover::before {
            left: 100%;
        }
        
        .remove-section-btn:hover,
        .remove-item-btn:hover,
        .remove-example:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.3);
        }
        
        .add-item-btn,
        .add-example-btn,
        .add-section-btn {
            background: linear-gradient(135deg, #000000, #374151);
            color: #ffffff;
            border: none;
            border-radius: 12px;
            padding: 12px 20px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin-top: 12px;
            position: relative;
            overflow: hidden;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-family: "Geist", sans-serif;
        }
        
        .add-item-btn::before,
        .add-example-btn::before,
        .add-section-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .add-item-btn:hover::before,
        .add-example-btn:hover::before,
        .add-section-btn:hover::before {
            left: 100%;
        }
        
        .add-item-btn:hover,
        .add-example-btn:hover,
        .add-section-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }
        
        .add-section-btn {
            width: 100%;
            font-size: 1.1rem;
            padding: 18px 24px;
            justify-content: center;
            margin-top: 30px;
            border-radius: 16px;
        }
        
        /* Form Elements Consistency */
        #systemMessage,
        #userMessagePreamble,
        #userMessagePreview {
            border: 2px solid transparent;
            border-radius: 16px;
            padding: 20px;
            font-size: 1rem;
            background: #f9fafb;
            color: #1f2937;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: "Geist", sans-serif;
            resize: vertical;
            min-height: 120px;
        }
        
        #systemMessage:focus,
        #userMessagePreamble:focus,
        #userMessagePreview:focus {
            border-color: #000000;
            background: #ffffff;
            outline: none;
            box-shadow: 0 0 0 4px rgba(0, 0, 0, 0.1);
            transform: translateY(-1px);
        }
        
        /* Total Points Display */
        #totalPoints {
            font-size: 1.5rem;
            font-weight: 700;
            color: #000000;
            background: linear-gradient(135deg, #f9fafb, #ffffff);
            padding: 16px 24px;
            border-radius: 16px;
            border: 2px solid #e5e7eb;
            text-align: center;
            margin: 20px 0;
            transition: all 0.3s ease;
            font-family: "Geist", sans-serif;
        }
        
        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .section-title-row {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
            }
            
            .section-name-input {
                min-width: unset;
            }
            
            .item-content {
                flex-direction: column;
                align-items: stretch;
            }
            
            .item-description {
                min-width: unset;
            }
            
            .item-examples {
                margin-left: 0;
            }
            
            .rubric-section {
                padding: 20px;
            }
        }

        /* Enhanced section transitions based on state */
        .content-state-processing .promptgen-section {
            padding-bottom: 30px;
        }

        .content-state-dashboard .promptgen-section {
            padding-bottom: 20px;
        }

        .footer {
            margin-top: auto;
            background: #ffffff;
            /* Removed border-top line completely */
            transition: margin-top 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Dynamic footer positioning based on content state */
        .content-state-initial .footer {
            margin-top: auto;
        }

        .content-state-processing .footer {
            margin-top: 60px;
        }

        .content-state-dashboard .footer {
            margin-top: 80px;
        }

        /* GLOBAL BUTTON CENTERING - AFFECTS ALL PAGES */
        .button-flex {
            display: flex !important;
            justify-content: center !important;
            align-items: center !important;
            text-align: center !important;
            width: 100% !important;
        }

        .button-flex.center-mobile {
            display: flex !important;
            justify-content: center !important;
            align-items: center !important;
            text-align: center !important;
            width: 100% !important;
        }

        /* Ensure button containers are centered */
        .margin-30 .button-flex,
        .margin-40 .button-flex {
            display: flex !important;
            justify-content: center !important;
            align-items: center !important;
            text-align: center !important;
            width: 100% !important;
        }

        /* Center individual buttons */
        .button-first {
            margin: 0 auto !important;
            display: inline-block !important;
        }

        .promptgen-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .promptgen-header {
            text-align: center;
            margin-bottom: 60px;
            padding-top: 40px;
        }

        .breadcrumb-nav {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 20px;
            text-decoration: none;
            transition: all 0.3s ease;
            font-family: "Geist", sans-serif;
        }

        .breadcrumb-nav:hover {
            color: #000000;
        }

        .promptgen-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 1rem;
            font-family: "Geist", sans-serif;
        }

        .promptgen-subtitle {
            font-size: 1.1rem;
            color: #6b7280;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
            font-family: "Geist", sans-serif;
        }

        .content-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 40px;
            max-width: 800px;
            margin: 0 auto;
            margin-bottom: 20px;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Smooth adaptive content transitions */
        .content-grid.file-uploaded {
            margin-bottom: 30px;
            transform: translateY(0);
        }

        .content-grid.processing-active {
            margin-bottom: 40px;
            transform: translateY(-10px);
        }

        .content-grid.dashboard-visible {
            margin-bottom: 50px;
            transform: translateY(-20px);
        }

        /* Upload Section - Enhanced with subtle rainbow accent */
        .upload-card {
            background: #ffffff;
            border-radius: 20px;
            padding: 50px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06), 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 2px dashed #e5e7eb;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .upload-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: #000000;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1;
        }

        .upload-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0,0,0,0.02), transparent);
            transition: left 0.6s ease;
        }

        .upload-card:hover::before {
            left: 100%;
        }

        .upload-card:hover::after,
        .upload-card.dragover::after {
            opacity: 1;
        }

        .upload-card.dragover {
            border-color: #000000;
            background: #ffffff;
            transform: scale(1.02);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15), 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .upload-content {
            text-align: center;
        }

        .upload-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 30px;
            padding: 20px;
            background: #f3f4f6;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .upload-card:hover .upload-icon {
            background: #000000;
            color: #ffffff;
            transform: scale(1.1);
        }

        .upload-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #000000;
            margin-bottom: 10px;
            font-family: "Geist", sans-serif;
        }

        .upload-description {
            color: #6b7280;
            margin-bottom: 30px;
            font-size: 1rem;
            font-family: "Geist", sans-serif;
        }

        .file-input {
            display: none;
        }

        .upload-button {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            padding: 16px 32px;
            background: #000000;
            color: #ffffff;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            position: relative;
            overflow: hidden;
            font-family: "Geist", sans-serif;
        }

        .upload-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .upload-button:hover::before {
            left: 100%;
        }

        .upload-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        /* Processing Section */
        .processing-card {
            background: #ffffff;
            border-radius: 20px;
            padding: 50px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06), 0 2px 4px rgba(0, 0, 0, 0.08);
            border: 1px solid #f1f3f4;
            opacity: 0;
            transform: translateY(30px) scale(0.98);
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .processing-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: #000000;
            background-size: 200% 100%;
            opacity: 1;
        }

        .processing-card.visible {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        .processing-card.processed-success {
            background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%);
            border: 2px solid #10b981;
            box-shadow: 0 8px 30px rgba(16, 185, 129, 0.15);
            transform: translateY(0) scale(1);
        }

        .processing-card.processed-success::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #10b981, #059669);
            opacity: 1;
        }

        /* Process button success state */
        .process-button.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
        }

        .process-button.success:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            transform: translateY(-1px);
        }

        /* Progress indicator */
        .progress-steps {
            display: flex;
            justify-content: space-between;
            margin: 2rem 0;
            padding: 0 1rem;
            position: relative;
        }

        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            color: #6b7280;
            font-size: 0.875rem;
            transition: all 0.3s ease;
            position: relative;
            flex: 1;
            z-index: 2;
        }

        .progress-step:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 16px;
            left: 50%;
            width: 100%;
            height: 2px;
            background: #e5e7eb;
            z-index: 1;
            transition: all 0.3s ease;
        }

        .progress-step.active {
            color: #3b82f6;
            font-weight: 600;
        }

        .progress-step.completed {
            color: #10b981;
            font-weight: 600;
        }

        .progress-step.completed:not(:last-child)::after {
            background: #10b981;
        }

        .progress-step.active:not(:last-child)::after {
            background: linear-gradient(90deg, #3b82f6 50%, #e5e7eb 50%);
        }

        .progress-step-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            font-weight: bold;
            transition: all 0.3s ease;
            position: relative;
            z-index: 3;
        }

        .progress-step.active .progress-step-icon {
            background: #3b82f6;
            color: white;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.2);
            animation: pulse 2s infinite;
        }

        .progress-step.completed .progress-step-icon {
            background: #10b981;
            color: white;
            transform: scale(1.1);
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        /* Enhanced status message styles */
        .status-message {
            padding: 1rem 1.25rem;
            border-radius: 12px;
            margin: 0.75rem 0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 500;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
            font-family: "Geist", sans-serif;
        }

        .status-message.fade-in {
            opacity: 1;
            transform: translateY(0);
        }

        .status-message.processing {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border: 1px solid #3b82f6;
            color: #1e40af;
        }

        .status-message.success {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border: 1px solid #10b981;
            color: #047857;
        }

        .status-message.error {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border: 1px solid #ef4444;
            color: #dc2626;
        }

        /* Mobile responsiveness for progress steps */
        @media (max-width: 768px) {
            .progress-steps {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }
            
            .progress-step {
                flex-direction: row;
                justify-content: flex-start;
                text-align: left;
            }
            
            .progress-step::after {
                display: none;
            }
        }

        .file-preview {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background: #f9fafb;
            border-radius: 16px;
            border: 1px solid #e5e7eb;
        }

        .file-icon {
            width: 50px;
            height: 50px;
            background: #000000;
            color: #ffffff;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .file-info h3 {
            font-weight: 600;
            color: #000000;
            margin-bottom: 5px;
            font-family: "Geist", sans-serif;
        }

        .file-info p {
            color: #6b7280;
            font-size: 0.9rem;
            font-family: "Geist", sans-serif;
        }

        .process-button {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            padding: 18px 36px;
            background: linear-gradient(135deg, #000000 0%, #374151 100%);
            color: #ffffff;
            border: none;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            width: 100%;
            justify-content: center;
            margin-bottom: 20px;
            font-family: "Geist", sans-serif;
        }

        .process-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .process-button:hover::before {
            left: 100%;
        }

        .process-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
        }

        .process-button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        /* Status Messages */
        .status-message {
            padding: 20px;
            border-radius: 16px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 500;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
            font-family: "Geist", sans-serif;
        }

        .status-message.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .status-message.processing {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: #ffffff;
        }

        .status-message.success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: #ffffff;
        }

        .status-message.error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: #ffffff;
        }

        /* Loading Animation */
        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #ffffff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Dashboard Section - Enhanced with subtle rainbow accent */
        .dashboard-card {
            background: #ffffff;
            border-radius: 20px;
            padding: 50px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06), 0 2px 4px rgba(0, 0, 0, 0.08);
            border: 1px solid #f1f3f4;
            opacity: 0;
            transform: translateY(40px) scale(0.96);
            transition: all 0.7s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .dashboard-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: #000000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .dashboard-card.visible {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        .dashboard-card.visible::before {
            opacity: 1;
        }

        .dashboard-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .dashboard-title {
            font-family: "Prata", serif;
            font-size: 2rem;
            font-weight: 400;
            color: #000000;
            margin-bottom: 10px;
        }

        .dashboard-description {
            color: #6b7280;
            font-size: 1.1rem;
            font-family: "Geist", sans-serif;
        }

        .rubric-info {
            background: linear-gradient(135deg, #f9fafb 0%, #ffffff 100%);
            border: 1px solid #e5e7eb;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .rubric-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #000000;
            margin-bottom: 10px;
            font-family: "Geist", sans-serif;
        }

        .rubric-description {
            color: #6b7280;
            margin-bottom: 15px;
            font-family: "Geist", sans-serif;
        }

        .total-points {
            display: inline-flex;
            align-items: center;
            background: #f3f4f6;
            border-radius: 25px;
            padding: 8px 16px;
            font-size: 0.875rem;
            font-weight: 500;
            color: #000000;
            font-family: "Geist", sans-serif;
        }

        .export-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .export-button {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 16px 24px;
            background: #ffffff;
            color: #000000;
            border: 2px solid #e5e7eb;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            font-family: "Geist", sans-serif;
        }

        .export-button:hover {
            border-color: #000000;
            background: #000000;
            color: #ffffff;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .promptgen-container {
                padding: 0 15px;
            }

            .upload-card,
            .processing-card,
            .dashboard-card {
                padding: 30px 20px;
            }

            .promptgen-title {
                font-size: 2.5rem;
            }

            .export-options {
                grid-template-columns: 1fr;
            }
        }

        /* Animation Classes */
        .fade-in {
            animation: fadeIn 0.6s ease-out forwards;
        }

        .slide-up {
            animation: slideUp 0.6s ease-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(30px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Success checkmark animation */
        .checkmark {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: block;
            stroke-width: 2;
            stroke: #ffffff;
            stroke-miterlimit: 10;
            box-shadow: inset 0px 0px 0px #ffffff;
            animation: fill .4s ease-in-out .4s forwards, scale .3s ease-in-out .9s both;
        }

        .checkmark__circle {
            stroke-dasharray: 166;
            stroke-dashoffset: 166;
            stroke-width: 2;
            stroke-miterlimit: 10;
            stroke: #ffffff;
            fill: none;
            animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
        }

        .checkmark__check {
            transform-origin: 50% 50%;
            stroke-dasharray: 48;
            stroke-dashoffset: 48;
            animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
        }

        @keyframes stroke {
            100% {
                stroke-dashoffset: 0;
            }
        }

        @keyframes scale {
            0%, 100% {
                transform: none;
            }
            50% {
                transform: scale3d(1.1, 1.1, 1);
            }
        }

        /* Rubric Editor Styles */
        .rubric-editor-section {
            margin-bottom: 40px;
            padding: 25px;
            background: #f8fafc;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }

        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .editor-header h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
            margin: 0;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            font-weight: 500;
            color: #374151;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-input, .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            font-family: "Geist", sans-serif;
            background: white;
            box-sizing: border-box;
        }

        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: #000000;
            box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn-add-criterion {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: #000000;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-add-criterion:hover {
            background: #374151;
            transform: translateY(-1px);
        }

        .criteria-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .criterion-item {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            position: relative;
            transition: all 0.3s ease;
        }

        .criterion-item:hover {
            border-color: #d1d5db;
        }

        .criterion-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .criterion-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            background: #000000;
            color: white;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .btn-remove-criterion {
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px 8px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .btn-remove-criterion:hover {
            background: #dc2626;
        }

        .criterion-examples {
            margin-top: 15px;
        }

        .criterion-examples label {
            font-size: 13px;
            color: #6b7280;
        }

        .examples-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 8px;
        }

        .example-item {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .example-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 13px;
        }

        .btn-remove-example {
            background: #f87171;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 6px;
            cursor: pointer;
            font-size: 11px;
        }

        .btn-add-example {
            margin-top: 8px;
            padding: 6px 12px;
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            color: #374151;
        }

        .btn-add-example:hover {
            background: #e5e7eb;
        }

        .preview-box {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 13px;
            line-height: 1.6;
            color: #374151;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }

        .export-section {
            margin-top: 30px;
            padding: 25px;
            background: #f9fafb;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
        }

        .export-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .export-header h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
            margin: 0;
        }

        .export-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .export-button.primary {
            background: #000000;
            color: white;
        }

        .export-button.primary:hover {
            background: #374151;
            transform: translateY(-1px);
            border-color: #374151;
        }

        .export-button.secondary {
            background: #6366f1;
            color: white;
            border-color: #6366f1;
        }

        .export-button.secondary:hover {
            background: #4f46e5;
            border-color: #4f46e5;
            transform: translateY(-1px);
        }

        .export-button.tertiary {
            background: #f3f4f6;
            color: #374151;
            border-color: #d1d5db;
        }

        .export-button.tertiary:hover {
            background: #e5e7eb;
            border-color: #9ca3af;
        }

        @keyframes fill {
            100% {
                box-shadow: inset 0px 0px 0px 30px #ffffff;
            }
        }

        /* Dynamic Rubric Structure Styles */
        .section-container {
            margin-bottom: 2rem;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 1rem;
            background-color: #f9f9f9;
        }
        
        .section-header {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 1rem;
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 0.5rem;
        }
        
        .section-criteria {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .criterion-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            position: relative;
            transition: all 0.3s ease;
        }

        .criterion-card:hover {
            border-color: #d1d5db;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .criterion-card .criterion-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .criterion-card .criterion-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            background: #000000;
            color: white;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            flex-shrink: 0;
        }

        .criterion-card .criterion-name {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
        }

        .criterion-card .remove-btn {
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .criterion-card .remove-btn:hover {
            background: #dc2626;
        }

        .criterion-body {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .points-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .points-container label {
            font-size: 14px;
            font-weight: 500;
            color: #374151;
        }

        .max-points {
            width: 80px;
            padding: 6px 10px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .criterion-description {
            width: 100%;
            min-height: 60px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 0.5rem;
            font-size: 0.9rem;
            resize: vertical;
        }
        
        .description-container {
            margin-top: 0.5rem;
        }
        
        .description-container label {
            display: block;
            margin-bottom: 0.25rem;
            font-weight: 500;
            color: #555;
        }

        .examples-container label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 500;
            color: #374151;
        }

        .examples-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 12px;
        }

        .example-item {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .example-item input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 13px;
        }

        .remove-example {
            background: #f87171;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
        }

        .remove-example:hover {
            background: #ef4444;
        }

        .add-example-btn {
            padding: 8px 16px;
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            color: #374151;
            transition: all 0.3s ease;
        }

        .add-example-btn:hover {
            background: #e5e7eb;
            border-color: #9ca3af;
        }
    </style>

    <!-- Authentication Loading Screen -->
    <style>
        /* Show page content by default - NO HIDING */
        body {
            background: #ffffff;
            visibility: visible;
        }
        
        /* Simple auth overlay - only shows when needed */
        #auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 99999;
            font-family: 'Geist', 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        #auth-overlay.show {
            display: flex;
        }
        
        .auth-content {
            text-align: center;
            padding: 40px;
        }
        
        .auth-logo {
            width: 80px;
            height: auto;
            margin-bottom: 30px;
        }
        
        .auth-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(59, 130, 246, 0.1);
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .auth-text {
            color: #64748b;
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 8px;
        }
        
        .auth-subtitle {
            color: #94a3b8;
            font-size: 14px;
            font-weight: 400;
        }
    </style>

    <!-- Simple Authentication Check -->
    <script>
        // Check authentication using our custom session system
        function checkAuth() {
            try {
                // Show auth overlay immediately
                showAuthOverlay();
                
                console.log('Checking authentication...');
                
                // Check for stored session
                const sessionData = localStorage.getItem('oski_session');
                const userData = localStorage.getItem('oski_user');
                
                if (!sessionData || !userData) {
                    console.log('No session found, redirecting to login');
                    hideAuthOverlay();
                    window.location.replace('login.html');
                    return;
                }
                
                const session = JSON.parse(sessionData);
                const user = JSON.parse(userData);
                
                // Check if session is still valid
                if (!session.expires_at || Date.now() >= session.expires_at) {
                    console.log('Session expired, redirecting to login');
                    localStorage.removeItem('oski_session');
                    localStorage.removeItem('oski_user');
                    hideAuthOverlay();
                    window.location.replace('login.html');
                    return;
                }
                
                console.log('User authenticated:', user.email);
                
                // Hide auth overlay with a brief delay for smooth UX
                setTimeout(() => {
                    hideAuthOverlay();
                }, 800);
                
                // Add logout functionality
                window.logout = function() {
                    console.log('Logging out...');
                    localStorage.removeItem('oski_session');
                    localStorage.removeItem('oski_user');
                    window.location.replace('login.html');
                };
                
                // Set up session monitoring
                setInterval(() => {
                    const currentSession = localStorage.getItem('oski_session');
                    if (!currentSession) {
                        console.log('Session removed, redirecting to login');
                        window.location.replace('login.html');
                    } else {
                        const sessionObj = JSON.parse(currentSession);
                        if (Date.now() >= sessionObj.expires_at) {
                            console.log('Session expired during use, redirecting to login');
                            localStorage.removeItem('oski_session');
                            localStorage.removeItem('oski_user');
                            window.location.replace('login.html');
                        }
                    }
                }, 60000); // Check every minute
                
            } catch (error) {
                console.error('Auth check failed:', error);
                localStorage.removeItem('oski_session');
                localStorage.removeItem('oski_user');
                hideAuthOverlay();
                window.location.replace('login.html');
            }
        }
        
        function showAuthOverlay() {
            const overlay = document.getElementById('auth-overlay');
            if (overlay) {
                overlay.classList.add('show');
            }
        }
        
        function hideAuthOverlay() {
            const overlay = document.getElementById('auth-overlay');
            if (overlay) {
                overlay.classList.remove('show');
            }
        }
        
        // Wait for page to load, then check auth
        document.addEventListener('DOMContentLoaded', function() {
            // Add auth overlay to page
            const authHTML = `
                <div id="auth-overlay">
                    <div class="auth-content">
                        <img src="images/Oski.png" alt="Oski" class="auth-logo">
                        <div class="auth-spinner"></div>
                        <div class="auth-text">Verifying access permissions</div>
                        <div class="auth-subtitle">Please wait...</div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', authHTML);
            
            // Check authentication after a brief delay
            setTimeout(checkAuth, 100);
        });
    </script>
</head>

<body>
    <div class="page-wrapper">
        <!-- Header will be injected here -->
        <div id="header-container"></div>

        <!-- Rubricon Section -->
        <section class="promptgen-section">
            <div class="promptgen-container">
                                 <!-- Header -->
                 <div class="promptgen-header fade-in">
                     <div class="top-text">Interactive Demo</div>
                     <h1 class="display-1">Experience Oski's <span class="other-font">Rubricon</span> platform.</h1>
                     <div class="margin-20">
                         <p class="p-02">AI-Powered Rubric to Assessment Prompt Generator</p>
                     </div>
                     <div class="margin-30">
                         <div class="button-flex center-mobile" style="display: flex !important; justify-content: center !important; align-items: center !important; text-align: center !important; width: 100% !important;">
                             <a href="#upload" class="button-first w-inline-block">
                                 <div class="txt-wrapper">
                                     <div class="button-txt">Get Started</div>
                                     <div class="button-txt">Get Started</div>
                                 </div>
                             </a>
                         </div>
                     </div>
                 </div>

                <div class="content-grid">
                    <!-- Upload Section -->
                    <div class="upload-card slide-up" id="upload">
                        <div class="upload-content">
                            <div class="upload-icon">
                                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="7 10 12 15 17 10"></polyline>
                                    <line x1="12" y1="15" x2="12" y2="3"></line>
                                </svg>
                            </div>
                            <h2 class="upload-title">Upload Your Rubric</h2>
                            <p class="upload-description">Drag and drop your rubric file here, or click to browse.<br>
                            Supports: PDF, Word (.docx/.doc), and Excel (.xlsx/.xls) files only.</p>
                            
                            <input type="file" id="fileInput" class="file-input" accept=".pdf,.doc,.docx,.xls,.xlsx">
                            <button class="upload-button" onclick="document.getElementById('fileInput').click()">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="17 8 12 3 7 8"></polyline>
                                    <line x1="12" y1="3" x2="12" y2="15"></line>
                                </svg>
                                Choose File
                            </button>
                        </div>
                    </div>

                    <!-- Processing Section -->
                    <div class="processing-card" id="processingSection">
                        <div id="filePreview" class="file-preview" style="display: none;">
                            <div class="file-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14 2 14 8 20 8"></polyline>
                                </svg>
                            </div>
                            <div class="file-info">
                                <h3 id="fileName">No file selected</h3>
                                <p id="fileSize">Select a file to continue</p>
                            </div>
                        </div>

                        <button class="process-button" id="processButton" disabled onclick="processRubric()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="5 3 19 12 5 21 5 3"></polygon>
                            </svg>
                            Process Rubric
                        </button>

                        <div id="statusMessages"></div>
                    </div>

                    <!-- Dashboard Section -->
                    <div class="dashboard-card" id="dashboardSection">
                        <div class="dashboard-header">
                            <h2 class="dashboard-title">Rubric Editor</h2>
                            <p class="dashboard-description">Review and edit your OSCE assessment criteria before exporting to YAML format.</p>
                        </div>

                        <!-- Rubric Basic Info -->
                        <div class="rubric-editor-section">
                            <div class="editor-header">
                                <h3>Basic Information</h3>
                            </div>

                            <div class="input-group">
                                <label for="systemMessage">System Message:</label>
                                <textarea id="systemMessage" class="form-textarea" rows="3" placeholder="You are a helpful assistant..."></textarea>
                            </div>
                        </div>

                        <!-- Criteria Editor -->
                        <div class="rubric-editor-section">
                            <div class="editor-header">
                                <h3>Assessment Criteria</h3>
                                <button class="btn-add-criterion" onclick="addNewCriterion()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="12" y1="5" x2="12" y2="19"></line>
                                        <line x1="5" y1="12" x2="19" y2="12"></line>
                                    </svg>
                                    Add Criterion
                                </button>
                            </div>
                            <div id="criteriaContainer" class="criteria-container">
                                <!-- Criteria will be added dynamically -->
                            </div>
                        </div>

                        <!-- User Message Preview -->
                        <div class="rubric-editor-section">
                            <div class="editor-header">
                                <h3>Generated User Message Preview</h3>
                            </div>
                            <div class="preview-box" id="userMessagePreview">
                                <!-- Preview will be generated automatically -->
                            </div>
                        </div>

                        <!-- Export Options -->
                        <div class="export-section">
                            <div class="export-header">
                                <h3>Export Options</h3>
                                <div class="total-points">
                                    Total Points: <span id="totalPoints">0</span>
                                </div>
                            </div>
                            <div class="export-buttons">
                                <button class="export-button primary" onclick="downloadYaml()">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                        <polyline points="7 10 12 15 17 10"></polyline>
                                        <line x1="12" y1="15" x2="12" y2="3"></line>
                                    </svg>
                                    Download YAML
                                </button>
                                <button class="export-button tertiary" onclick="resetUpload()">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
                                        <path d="M21 3v5h-5"></path>
                                        <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
                                        <path d="M3 21v-5h5"></path>
                                    </svg>
                                    Start Over
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer will be injected here -->
        <div id="footer-container"></div>
    </div>

    <!-- Oski JavaScript Framework -->
    <script src="js/js-jquery-3.5.1.min.dc5e7f18c8.js" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="js/js-webflow.schunk.36b8fb49256177c8.js" type="text/javascript"></script>
    <script src="js/js-webflow.schunk.4bcee8dc3a55ab3d.js" type="text/javascript"></script>
    <script src="js/js-webflow.965f2b6a.2a699015d3217d92.js" type="text/javascript"></script>
    <script src="js/header.js" type="text/javascript"></script>
    <script src="js/footer.js" type="text/javascript"></script>

    <!-- Rubricon JavaScript -->
    <script>
        let currentFile = null;
        let processedData = null;
        let currentTaskId = null;

        // Backend URL - Points to the rubrics-to-prompts backend
        const BACKEND_URL = 'http://localhost:8000';

        // Perfect adaptive footer state management
        function updateFooterState(state) {
            const body = document.body;
            
            // Remove all existing content state classes
            body.classList.remove('content-state-initial', 'content-state-processing', 'content-state-dashboard');
            
            // Add new state class with smooth transition
            body.classList.add(`content-state-${state}`);
            
            console.log(`Footer state updated to: ${state}`);
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize footer state
            updateFooterState('initial');
            
            setupFileUpload();
            setupDragAndDrop();
        });

        function setupFileUpload() {
            const fileInput = document.getElementById('fileInput');
            
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    handleFileSelection(file);
                }
            });
        }

        function setupDragAndDrop() {
            const uploadCard = document.getElementById('upload');

            uploadCard.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadCard.classList.add('dragover');
            });

            uploadCard.addEventListener('dragleave', function(e) {
                e.preventDefault();
                uploadCard.classList.remove('dragover');
            });

            uploadCard.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadCard.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileSelection(files[0]);
                }
            });
        }

        function handleFileSelection(file) {
            currentFile = file;
            
            // Update file preview
            const filePreview = document.getElementById('filePreview');
            const fileName = document.getElementById('fileName');
            const fileSize = document.getElementById('fileSize');
            const processButton = document.getElementById('processButton');

            filePreview.style.display = 'flex';
            fileName.textContent = file.name;
            fileSize.textContent = formatFileSize(file.size);
            processButton.disabled = false;
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function showStatus(type, message, showSpinner = false) {
            const statusMessages = document.getElementById('statusMessages');
            const statusDiv = document.createElement('div');
            statusDiv.className = `status-message ${type}`;
            
            if (showSpinner && type === 'processing') {
                statusDiv.innerHTML = `
                    <div class="loading-spinner"></div>
                    <span>${message}</span>
                `;
            } else {
                statusDiv.innerHTML = `<span>${message}</span>`;
            }
            
            statusMessages.appendChild(statusDiv);
            statusDiv.scrollIntoView({ behavior: 'smooth' });
        }

        async function processRubric() {
            if (!currentFile) {
                showStatus('error', 'Please select a file first.');
                return;
            }
            
            const processButton = document.getElementById('processButton');
            const statusMessages = document.getElementById('statusMessages');
            
            // Disable button and show processing state
            processButton.disabled = true;
            processButton.innerHTML = `
                <div class="loading-spinner"></div>
                Processing...
            `;
            
            // Clear previous status messages
            statusMessages.innerHTML = '';
            showStatus('processing', 'Analyzing your rubric...', true);

            try {
                // Create form data for the backend
                const formData = new FormData();
                formData.append('file', currentFile);

                // Send to the rubrics-to-prompts backend
                const response = await fetch(`${BACKEND_URL}/upload-rubric`, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.detail || result.message || 'Processing failed');
                }

                // Store task ID for status polling
                currentTaskId = result.task_id;
                
                // Poll for completion
                await pollProcessingStatus(currentTaskId);
                
            } catch (error) {
                console.error('Processing failed:', error);
                showStatus('error', `Processing failed: ${error.message}`);
                
                // Reset button
                processButton.disabled = false;
                processButton.classList.remove('success');
                processButton.innerHTML = `
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="5 3 19 12 5 21 5 3"></polygon>
                    </svg>
                    Process Rubric
                `;
            }
        }

        async function pollProcessingStatus(taskId) {
            const maxAttempts = 120; // 2 minutes max
            let attempts = 0;
            
            while (attempts < maxAttempts) {
                try {
                    const response = await fetch(`${BACKEND_URL}/status/${taskId}`);
                    const status = await response.json();
                    
                    if (status.completed) {
                        // Processing completed successfully
                        const rubricData = convertToRubriconFormat(status.result);
                        
                        // Show success message
                        showStatus('success', `✅ Successfully processed! Found ${rubricData.criteria?.length || 0} criteria from your rubric.`);
                        
                        // Update process button to show completion
                        const processButton = document.getElementById('processButton');
                        processButton.classList.add('success');
                        processButton.innerHTML = `
                            <svg class="checkmark" width="20" height="20" viewBox="0 0 52 52">
                                <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none" stroke="#ffffff" stroke-width="2"/>
                                <path class="checkmark__check" fill="none" stroke="#ffffff" stroke-width="2" d="m16 26 6 6 12-12"/>
                            </svg>
                            Processed!
                        `;
                        
                        // Store processed data globally
                        window.currentRubricData = rubricData;
                        processedData = rubricData;
                        
                        // Show the dashboard
                        setTimeout(() => {
                            showDashboard(rubricData);
                        }, 500);
                        
                        return;
                    } else if (status.error) {
                        throw new Error(status.message || 'Processing failed');
                    }
                    
                    // Continue polling
                    attempts++;
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                } catch (error) {
                    console.error('Status polling error:', error);
                    throw error;
                }
            }
            
            throw new Error('Processing timeout - please try again');
        }

        // Convert backend result to rubricon format
        function convertToRubriconFormat(backendResult) {
            if (!backendResult || (!backendResult.parsed_yaml && !backendResult.criteria)) {
                throw new Error('Invalid rubric data received from backend');
            }

            // Handle both old and new response formats
            let criteria = [];
            let systemMessage = "You are a helpful assistant tasked with analyzing and scoring a recorded medical examination between a medical student and a patient. Provide your response in JSON format.";
            
            if (backendResult.parsed_yaml) {
                // New format with parsed_yaml
                const parsed = backendResult.parsed_yaml;
                systemMessage = parsed.system_message || systemMessage;
                criteria = parsed.criteria || [];
            } else if (backendResult.criteria) {
                // Direct criteria format
                criteria = backendResult.criteria;
            }

            // Ensure criteria have the required format
            const formattedCriteria = criteria.map((criterion, index) => ({
                name: criterion.name || criterion.criterion || `Criterion ${index + 1}`,
                max_points: criterion.max_points || criterion.points || 1,
                examples: criterion.examples || [],
                description: criterion.description || criterion.name || ""
            }));

            return {
                system_message: systemMessage,
                user_message_preamble: "Analyze the following medical examination and provide scores for each criterion:",
                criteria: formattedCriteria,
                assessment_type: backendResult.assessment_type || 'Medical Assessment',
                source_file: currentFile.name,
                total_points: formattedCriteria.reduce((sum, c) => sum + c.max_points, 0),
                processing_method: 'Backend API Processing',
                title: backendResult.title || 'Medical Assessment Rubric'
            };
        }

        function showDashboard(data) {
            console.log('Showing dashboard with data:', data);
            
            // Update footer state
            updateFooterState('dashboard');
            
            // Show dashboard section
            const dashboardSection = document.getElementById('dashboardSection');
            dashboardSection.style.display = 'block';
            
            // Scroll to dashboard
            dashboardSection.scrollIntoView({ behavior: 'smooth' });
            
            // Initialize dashboard with processed data
            initializeDashboard(data);
        }

        function initializeDashboard(data) {
            console.log('Initializing dashboard with data:', data);
            
            // Set basic information
            document.getElementById('systemMessage').value = data.system_message || 'You are a helpful assistant tasked with analyzing and scoring a recorded medical examination between a medical student and a patient. Provide your response in JSON format.';
            
            // Load criteria
            const criteria = data.criteria || [];
            console.log('Loading criteria:', criteria);
            
            loadCriteria(criteria);
            
            // Update total points
            updateTotalPoints();
            
            // Update preview
            updateUserMessagePreview();
        }

        function loadCriteria(criteria) {
            const container = document.getElementById('criteriaContainer');
            container.innerHTML = '';
            
            console.log('Loading criteria into DOM:', criteria);
            
            if (criteria && criteria.length > 0) {
                criteria.forEach((criterion, index) => {
                    console.log(`Adding criterion ${index + 1}:`, criterion);
                    addCriterionToDOM(criterion, index);
                });
            } else {
                console.log('No criteria provided, adding empty criterion');
                // Add one empty criterion if none exist
                addNewCriterion();
            }
        }

        function addNewCriterion() {
            const criterion = {
                name: '',
                max_points: 1,
                examples: ['']
            };
            const container = document.getElementById('criteriaContainer');
            const index = container.children.length;
            addCriterionToDOM(criterion, index);
            updateTotalPoints();
            updateUserMessagePreview();
        }

        function addCriterionToDOM(criterion, index) {
            const container = document.getElementById('criteriaContainer');
            const criterionDiv = document.createElement('div');
            criterionDiv.className = 'criterion-item';
            criterionDiv.dataset.index = index;
            
            // Ensure criterion has required fields
            const safeCriterion = {
                name: criterion?.name || '',
                max_points: criterion?.max_points || 1,
                examples: criterion?.examples || ['']
            };
            
            // Escape HTML in values to prevent issues
            const escapedName = safeCriterion.name.replace(/"/g, '&quot;');
            const escapedExamples = safeCriterion.examples.map(ex => (ex || '').replace(/"/g, '&quot;'));
            
            criterionDiv.innerHTML = `
                <div class="criterion-header">
                    <div style="display: flex; align-items: center;">
                        <span class="criterion-number">${index + 1}</span>
                        <div style="flex: 1;">
                            <div class="input-group" style="margin-bottom: 10px;">
                                <input type="text" class="form-input criterion-name" placeholder="e.g., Patient Greeting and Introduction" value="${escapedName}" oninput="updateCriterion(${index})">
                            </div>
                            <div class="input-group" style="margin-bottom: 0;">
                                <label>Max Points:</label>
                                <input type="number" class="form-input criterion-points" min="1" max="10" value="${safeCriterion.max_points}" oninput="updateCriterion(${index})" style="width: 80px;">
                            </div>
                        </div>
                    </div>
                    <button class="btn-remove-criterion" onclick="removeCriterion(${index})">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
                <div class="criterion-examples">
                    <label>Examples:</label>
                    <div class="examples-list">
                        ${escapedExamples.map((example, exampleIndex) => `
                            <div class="example-item">
                                <input type="text" class="example-input" placeholder="e.g., I'm going to examine your..." value="${example}" oninput="updateCriterion(${index})">
                                <button class="btn-remove-example" onclick="removeExample(${index}, ${exampleIndex})">×</button>
                            </div>
                        `).join('')}
                    </div>
                    <button class="btn-add-example" onclick="addExample(${index})">+ Add Example</button>
                </div>
            `;
            
            container.appendChild(criterionDiv);
        }

        function updateCriterion(index) {
            updateTotalPoints();
            updateUserMessagePreview();
        }

        function removeCriterion(index) {
            const container = document.getElementById('criteriaContainer');
            const item = container.children[index];
            if (item) {
                item.remove();
                reindexCriteria();
                updateTotalPoints();
                updateUserMessagePreview();
            }
        }

        function reindexCriteria() {
            const container = document.getElementById('criteriaContainer');
            Array.from(container.children).forEach((item, newIndex) => {
                item.dataset.index = newIndex;
                const numberSpan = item.querySelector('.criterion-number');
                if (numberSpan) {
                    numberSpan.textContent = newIndex + 1;
                }
                
                // Update onclick handlers
                const nameInput = item.querySelector('.criterion-name');
                const pointsInput = item.querySelector('.criterion-points');
                const removeBtn = item.querySelector('.btn-remove-criterion');
                const addExampleBtn = item.querySelector('.btn-add-example');
                
                if (nameInput) nameInput.setAttribute('oninput', `updateCriterion(${newIndex})`);
                if (pointsInput) pointsInput.setAttribute('oninput', `updateCriterion(${newIndex})`);
                if (removeBtn) removeBtn.setAttribute('onclick', `removeCriterion(${newIndex})`);
                if (addExampleBtn) addExampleBtn.setAttribute('onclick', `addExample(${newIndex})`);
                
                // Update example handlers
                const exampleInputs = item.querySelectorAll('.example-input');
                const removeExampleBtns = item.querySelectorAll('.btn-remove-example');
                
                exampleInputs.forEach(input => {
                    input.setAttribute('oninput', `updateCriterion(${newIndex})`);
                });
                
                removeExampleBtns.forEach((btn, exampleIndex) => {
                    btn.setAttribute('onclick', `removeExample(${newIndex}, ${exampleIndex})`);
                });
            });
        }

        function addExample(criterionIndex) {
            const container = document.getElementById('criteriaContainer');
            const criterionItem = container.children[criterionIndex];
            const examplesList = criterionItem.querySelector('.examples-list');
            const exampleIndex = examplesList.children.length;
            
            const exampleDiv = document.createElement('div');
            exampleDiv.className = 'example-item';
            exampleDiv.innerHTML = `
                <input type="text" class="example-input" placeholder="e.g., I'm going to examine your..." oninput="updateCriterion(${criterionIndex})">
                <button class="btn-remove-example" onclick="removeExample(${criterionIndex}, ${exampleIndex})">×</button>
            `;
            
            examplesList.appendChild(exampleDiv);
        }

        function removeExample(criterionIndex, exampleIndex) {
            const container = document.getElementById('criteriaContainer');
            const criterionItem = container.children[criterionIndex];
            const examplesList = criterionItem.querySelector('.examples-list');
            const exampleItem = examplesList.children[exampleIndex];
            if (exampleItem) {
                exampleItem.remove();
                updateCriterion(criterionIndex);
                
                // Reindex remaining examples
                const remainingExamples = examplesList.querySelectorAll('.btn-remove-example');
                remainingExamples.forEach((btn, newIndex) => {
                    btn.setAttribute('onclick', `removeExample(${criterionIndex}, ${newIndex})`);
                });
            }
        }

        function updateTotalPoints() {
            const container = document.getElementById('criteriaContainer');
            let total = 0;
            
            Array.from(container.children).forEach(item => {
                const pointsInput = item.querySelector('.criterion-points');
                if (pointsInput) {
                    total += parseInt(pointsInput.value) || 0;
                }
            });
            
            const totalPointsElement = document.getElementById('totalPoints');
            if (totalPointsElement) {
                totalPointsElement.textContent = total;
            }
        }

        function updateUserMessagePreview() {
            const systemMessage = document.getElementById('systemMessage').value;
            const container = document.getElementById('criteriaContainer');
            const criteria = [];
            
            Array.from(container.children).forEach((item, index) => {
                const nameInput = item.querySelector('.criterion-name');
                const pointsInput = item.querySelector('.criterion-points');
                const exampleInputs = item.querySelectorAll('.example-input');
                
                if (nameInput && nameInput.value.trim()) {
                    const examples = Array.from(exampleInputs)
                        .map(input => input.value.trim())
                        .filter(value => value.length > 0);
                    
                    criteria.push({
                        name: nameInput.value.trim(),
                        max_points: parseInt(pointsInput.value) || 1,
                        examples: examples
                    });
                }
            });
            
            if (criteria.length > 0) {
                const userMessage = generateUserMessage(criteria);
                document.getElementById('userMessagePreview').textContent = userMessage;
            } else {
                document.getElementById('userMessagePreview').textContent = 'No criteria defined yet. Add some criteria to see the preview.';
            }
        }

        function generateUserMessage(criteria) {
            let message = "Analyze the following medical examination and provide scores for each criterion:\n\n";
            
            criteria.forEach((criterion, index) => {
                message += `${index + 1}. ${criterion.name} (${criterion.max_points} points)\n`;
                if (criterion.examples && criterion.examples.length > 0) {
                    message += `   Examples: ${criterion.examples.join(', ')}\n`;
                }
                message += '\n';
            });
            
            message += 'Provide your response in JSON format with scores and justifications for each criterion.';
            
            return message;
        }

        function getCurrentRubricData() {
            const systemMessage = document.getElementById('systemMessage').value;
            const container = document.getElementById('criteriaContainer');
            const criteria = [];
            
            Array.from(container.children).forEach((item, index) => {
                const nameInput = item.querySelector('.criterion-name');
                const pointsInput = item.querySelector('.criterion-points');
                const exampleInputs = item.querySelectorAll('.example-input');
                
                if (nameInput && nameInput.value.trim()) {
                    const examples = Array.from(exampleInputs)
                        .map(input => input.value.trim())
                        .filter(value => value.length > 0);
                    
                    criteria.push({
                        criterion: nameInput.value.trim(),
                        max_points: parseInt(pointsInput.value) || 1,
                        examples: examples
                    });
                }
            });
            
            return {
                system_message: systemMessage,
                user_message: generateUserMessage(criteria.map(c => ({
                    name: c.criterion,
                    max_points: c.max_points,
                    examples: c.examples
                }))),
                criteria: criteria
            };
        }

        async function downloadYaml() {
            try {
                if (!currentTaskId) {
                    alert('No rubric data available for download. Please process a rubric first.');
                    return;
                }

                // Get the YAML from the backend
                const response = await fetch(`${BACKEND_URL}/download-yaml/${currentTaskId}`);
                
                if (!response.ok) {
                    throw new Error('Failed to download YAML file');
                }

                // Get the YAML content
                const blob = await response.blob();
                
                // Create download link
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'assessment-rubric.yaml';
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                
                console.log('YAML file downloaded successfully');
                
            } catch (error) {
                console.error('Download failed:', error);
                alert('Failed to download YAML file. Please try again.');
            }
        }

        function resetUpload() {
            // Reset all state
            currentFile = null;
            processedData = null;
            currentTaskId = null;
            
            // Reset UI
            const fileInput = document.getElementById('fileInput');
            const filePreview = document.getElementById('filePreview');
            const fileName = document.getElementById('fileName');
            const fileSize = document.getElementById('fileSize');
            const processButton = document.getElementById('processButton');
            const statusMessages = document.getElementById('statusMessages');
            const dashboardSection = document.getElementById('dashboardSection');
            
            fileInput.value = '';
            filePreview.style.display = 'none';
            fileName.textContent = 'No file selected';
            fileSize.textContent = 'Select a file to continue';
            processButton.disabled = true;
            processButton.classList.remove('success');
            processButton.innerHTML = `
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="5 3 19 12 5 21 5 3"></polygon>
                </svg>
                Process Rubric
            `;
            statusMessages.innerHTML = '';
            dashboardSection.style.display = 'none';
            
            // Update footer state
            updateFooterState('initial');
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html> 